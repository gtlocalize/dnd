(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Vr=!1;var hn=Array.isArray,Ws=Array.prototype.indexOf,vr=Array.from,In=Object.defineProperty,qa=Object.getOwnPropertyDescriptor,Wr=Object.getOwnPropertyDescriptors,Ys=Object.prototype,Zs=Array.prototype,dr=Object.getPrototypeOf,qr=Object.isExtensible;function Js(e){return typeof e=="function"}const Et=()=>{};function Xs(e){return e()}function Rn(e){for(var a=0;a<e.length;a++)e[a]()}function Yr(){var e,a,n=new Promise((r,s)=>{e=r,a=s});return{promise:n,resolve:e,reject:a}}function ei(e,a){if(Array.isArray(e))return e;if(!(Symbol.iterator in e))return Array.from(e);const n=[];for(const r of e)if(n.push(r),n.length===a)break;return n}const lt=2,fr=4,On=8,wa=16,ia=32,Ra=64,pr=128,At=256,Dn=512,Je=1024,kt=2048,oa=4096,Ht=8192,Da=16384,Fn=32768,wn=65536,Sr=1<<17,ti=1<<18,Ja=1<<19,Zr=1<<20,ar=1<<21,Un=1<<22,Sa=1<<23,ra=Symbol("$state"),ai=Symbol("legacy props"),ni=Symbol(""),Ha=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function mr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ri(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function si(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ii(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function oi(e){throw new Error("https://svelte.dev/e/effect_orphan")}function li(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ci(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function ui(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function vi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function di(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function fi(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Hn=1,Gn=2,Jr=4,pi=8,mi=16,_i=1,gi=2,hi=4,wi=8,bi=16,yi=1,xi=2,Ei=4,ki=1,qi=2,Ze=Symbol(),Si="http://www.w3.org/1999/xhtml";function $i(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Ai=!1;function Xr(e){return e===this.v}function es(e,a){return e!=e?a==a:e!==a||e!==null&&typeof e=="object"||typeof e=="function"}function ts(e){return!es(e,this.v)}let Xa=!1,Ci=!1;function Ti(){Xa=!0}let Te=null;function za(e){Te=e}function rt(e,a=!1,n){Te={p:Te,c:null,e:null,s:e,x:null,l:Xa&&!a?{s:null,u:null,$:[]}:null}}function st(e){var a=Te,n=a.e;if(n!==null){a.e=null;for(var r of n)gs(r)}return e!==void 0&&(a.x=e),Te=a.p,e??{}}function bn(){return!Xa||Te!==null&&Te.l===null}let ka=[];function as(){var e=ka;ka=[],Rn(e)}function Wt(e){if(ka.length===0&&!vn){var a=ka;queueMicrotask(()=>{a===ka&&as()})}ka.push(e)}function Ii(){for(;ka.length>0;)as()}const Ri=new WeakMap;function ns(e){var a=ve;if(a===null)return pe.f|=Sa,e;if((a.f&Fn)===0){if((a.f&pr)===0)throw!a.parent&&e instanceof Error&&rs(e),e;a.b.error(e)}else Va(e,a)}function Va(e,a){for(;a!==null;){if((a.f&pr)!==0)try{a.b.error(e);return}catch(n){e=n}a=a.parent}throw e instanceof Error&&rs(e),e}function rs(e){const a=Ri.get(e);a&&(In(e,"message",{value:a.message}),In(e,"stack",{value:a.stack}))}const Sn=new Set;let De=null,Cn=null,Ot=null,nr=new Set,zt=[],Bn=null,rr=!1,vn=!1;class Vt{current=new Map;#n=new Map;#a=new Set;#d=0;#s=null;#l=[];#r=[];#t=[];#e=[];#i=[];#c=[];skipped_effects=new Set;process(a){zt=[],Cn=null,this.apply();for(const i of a)this.#u(i);if(this.#d===0){var n=Ot;this.#v();var r=this.#r,s=this.#t;this.#r=[],this.#t=[],this.#e=[],Cn=this,De=null,Ot=n,$r(r),$r(s),Cn=null,this.#s?.resolve()}else this.#o(this.#r),this.#o(this.#t),this.#o(this.#e);Ot=null;for(const i of this.#l)Ya(i);this.#l=[]}#u(a){a.f^=Je;for(var n=a.first;n!==null;){var r=n.f,s=(r&(ia|Ra))!==0,i=s&&(r&Je)!==0,o=i||(r&Ht)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){s?n.f^=Je:(r&fr)!==0?this.#t.push(n):(r&Je)===0&&((r&Un)!==0&&n.b?.is_pending()?this.#l.push(n):kn(n)&&((n.f&wa)!==0&&this.#e.push(n),Ya(n)));var v=n.first;if(v!==null){n=v;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}}#o(a){for(const n of a)((n.f&kt)!==0?this.#i:this.#c).push(n),nt(n,Je);a.length=0}capture(a,n){this.#n.has(a)||this.#n.set(a,n),this.current.set(a,a.v),Ot?.set(a,a.v)}activate(){De=this}deactivate(){De=null,Ot=null}flush(){if(zt.length>0){if(this.activate(),ss(),De!==null&&De!==this)return}else this.#d===0&&this.#v();this.deactivate();for(const a of nr)if(nr.delete(a),a(),De!==null)break}#v(){for(const a of this.#a)a();if(this.#a.clear(),Sn.size>1){this.#n.clear();let a=!0;for(const n of Sn){if(n===this){a=!1;continue}const r=[];for(const[i,o]of this.current){if(n.current.has(i))if(a&&o!==n.current.get(i))n.current.set(i,o);else continue;r.push(i)}if(r.length===0)continue;const s=[...n.current.keys()].filter(i=>!this.current.has(i));if(s.length>0){for(const i of r)is(i,s);if(zt.length>0){De=n,n.apply();for(const i of zt)n.#u(i);zt=[],n.deactivate()}}}De=null}Sn.delete(this)}increment(){this.#d+=1}decrement(){this.#d-=1;for(const a of this.#i)nt(a,kt),Aa(a);for(const a of this.#c)nt(a,oa),Aa(a);this.flush()}add_callback(a){this.#a.add(a)}settled(){return(this.#s??=Yr()).promise}static ensure(){if(De===null){const a=De=new Vt;Sn.add(De),vn||Vt.enqueue(()=>{De===a&&a.flush()})}return De}static enqueue(a){Wt(a)}apply(){}}function Di(e){var a=vn;vn=!0;try{for(var n;;){if(Ii(),zt.length===0&&(De?.flush(),zt.length===0))return Bn=null,n;ss()}}finally{vn=a}}function ss(){var e=Ka;rr=!0;try{var a=0;for(Tr(!0);zt.length>0;){var n=Vt.ensure();if(a++>1e3){var r,s;Mi()}n.process(zt),ha.clear()}}finally{rr=!1,Tr(e),Bn=null}}function Mi(){try{li()}catch(e){Va(e,Bn)}}let Ea=null;function $r(e){var a=e.length;if(a!==0){for(var n=0;n<a;){var r=e[n++];if((r.f&(Da|Ht))===0&&kn(r)&&(Ea=[],Ya(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?xs(r):r.fn=null),Ea?.length>0)){ha.clear();for(const s of Ea)Ya(s);Ea=[]}}Ea=null}}function is(e,a){if(e.reactions!==null)for(const n of e.reactions){const r=n.f;(r&lt)!==0?is(n,a):(r&(Un|wa))!==0&&os(n,a)&&(nt(n,kt),Aa(n))}}function os(e,a){if(e.deps!==null){for(const n of e.deps)if(a.includes(n)||(n.f&lt)!==0&&os(n,a))return!0}return!1}function Aa(e){for(var a=Bn=e;a.parent!==null;){a=a.parent;var n=a.f;if(rr&&a===ve&&(n&wa)!==0)return;if((n&(Ra|ia))!==0){if((n&Je)===0)return;a.f^=Je}}zt.push(a)}function Pi(e){let a=0,n=Ca(0),r;return()=>{Yi()&&(t(n),an(()=>(a===0&&(r=c(()=>e(()=>dn(n)))),a+=1,()=>{Wt(()=>{a-=1,a===0&&(r?.(),r=void 0,dn(n))})})))}}var ji=wn|Ja|pr;function Li(e,a,n){new Ni(e,a,n)}class Ni{parent;#n=!1;#a;#d=null;#s;#l;#r;#t=null;#e=null;#i=null;#c=null;#u=0;#o=0;#v=!1;#f=null;#g=()=>{this.#f&&Wa(this.#f,this.#u)};#h=Pi(()=>(this.#f=Ca(this.#u),()=>{this.#f=null}));constructor(a,n,r){this.#a=a,this.#s=n,this.#l=r,this.parent=ve.b,this.#n=!!this.#s.pending,this.#r=hr(()=>{ve.b=this;{try{this.#t=Nt(()=>r(this.#a))}catch(s){this.error(s)}this.#o>0?this.#m():this.#n=!1}},ji)}#w(){try{this.#t=Nt(()=>this.#l(this.#a))}catch(a){this.error(a)}this.#n=!1}#b(){const a=this.#s.pending;a&&(this.#e=Nt(()=>a(this.#a)),Vt.enqueue(()=>{this.#t=this.#p(()=>(Vt.ensure(),Nt(()=>this.#l(this.#a)))),this.#o>0?this.#m():(Qa(this.#e,()=>{this.#e=null}),this.#n=!1)}))}is_pending(){return this.#n||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#s.pending}#p(a){var n=ve,r=pe,s=Te;Yt(this.#r),mt(this.#r),za(this.#r.ctx);try{return a()}catch(i){return ns(i),null}finally{Yt(n),mt(r),za(s)}}#m(){const a=this.#s.pending;this.#t!==null&&(this.#c=document.createDocumentFragment(),Oi(this.#t,this.#c)),this.#e===null&&(this.#e=Nt(()=>a(this.#a)))}#_(a){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(a);return}this.#o+=a,this.#o===0&&(this.#n=!1,this.#e&&Qa(this.#e,()=>{this.#e=null}),this.#c&&(this.#a.before(this.#c),this.#c=null),Wt(()=>{Vt.ensure().flush()}))}update_pending_count(a){this.#_(a),this.#u+=a,nr.add(this.#g)}get_effect_pending(){return this.#h(),t(this.#f)}error(a){var n=this.#s.onerror;let r=this.#s.failed;if(this.#v||!n&&!r)throw a;this.#t&&(Ct(this.#t),this.#t=null),this.#e&&(Ct(this.#e),this.#e=null),this.#i&&(Ct(this.#i),this.#i=null);var s=!1,i=!1;const o=()=>{if(s){$i();return}s=!0,i&&fi(),Vt.ensure(),this.#u=0,this.#i!==null&&Qa(this.#i,()=>{this.#i=null}),this.#n=this.has_pending_snippet(),this.#t=this.#p(()=>(this.#v=!1,Nt(()=>this.#l(this.#a)))),this.#o>0?this.#m():this.#n=!1};var v=pe;try{mt(null),i=!0,n?.(a,o),i=!1}catch(l){Va(l,this.#r&&this.#r.parent)}finally{mt(v)}r&&Wt(()=>{this.#i=this.#p(()=>{this.#v=!0;try{return Nt(()=>{r(this.#a,()=>a,()=>o)})}catch(l){return Va(l,this.#r.parent),null}finally{this.#v=!1}})})}}function Oi(e,a){for(var n=e.nodes_start,r=e.nodes_end;n!==null;){var s=n===r?null:xn(n);a.append(n),n=s}}function Fi(e,a,n){const r=bn()?yn:Ft;if(a.length===0){n(e.map(r));return}var s=De,i=ve,o=Ui();Promise.all(a.map(v=>Hi(v))).then(v=>{o();try{n([...e.map(r),...v])}catch(l){(i.f&Da)===0&&Va(l,i)}s?.deactivate(),sr()}).catch(v=>{Va(v,i)})}function Ui(){var e=ve,a=pe,n=Te,r=De;return function(){Yt(e),mt(a),za(n),r?.activate()}}function sr(){Yt(null),mt(null),za(null)}function yn(e){var a=lt|kt,n=pe!==null&&(pe.f&lt)!==0?pe:null;return ve===null||n!==null&&(n.f&At)!==0?a|=At:ve.f|=Ja,{ctx:Te,deps:null,effects:null,equals:Xr,f:a,fn:e,reactions:null,rv:0,v:Ze,wv:0,parent:n??ve,ac:null}}function Hi(e,a){let n=ve;n===null&&ri();var r=n.b,s=void 0,i=Ca(Ze),o=!pe,v=new Map;return Xi(()=>{var l=Yr();s=l.promise;try{Promise.resolve(e()).then(l.resolve,l.reject).then(sr)}catch(y){l.reject(y),sr()}var u=De,g=r.is_pending();o&&(r.update_pending_count(1),g||(u.increment(),v.get(u)?.reject(Ha),v.delete(u),v.set(u,l)));const q=(y,b=void 0)=>{if(g||u.activate(),b)b!==Ha&&(i.f|=Sa,Wa(i,b));else{(i.f&Sa)!==0&&(i.f^=Sa),Wa(i,y);for(const[p,h]of v){if(v.delete(p),p===u)break;h.reject(Ha)}}o&&(r.update_pending_count(-1),g||u.decrement())};l.promise.then(q,y=>q(null,y||"unknown"))}),En(()=>{for(const l of v.values())l.reject(Ha)}),new Promise(l=>{function u(g){function q(){g===s?l(i):u(s)}g.then(q,q)}u(s)})}function Gi(e){const a=yn(e);return qs(a),a}function Ft(e){const a=yn(e);return a.equals=ts,a}function ls(e){var a=e.effects;if(a!==null){e.effects=null;for(var n=0;n<a.length;n+=1)Ct(a[n])}}function Bi(e){for(var a=e.parent;a!==null;){if((a.f&lt)===0)return a;a=a.parent}return null}function _r(e){var a,n=ve;Yt(Bi(e));try{ls(e),a=Cs(e)}finally{Yt(n)}return a}function cs(e){var a=_r(e);if(e.equals(a)||(e.v=a,e.wv=$s()),!Ma)if(Ot!==null)Ot.set(e,e.v);else{var n=(ga||(e.f&At)!==0)&&e.deps!==null?oa:Je;nt(e,n)}}const ha=new Map;function Ca(e,a){var n={f:0,v:e,reactions:null,equals:Xr,rv:0,wv:0};return n}function pa(e,a){const n=Ca(e);return qs(n),n}function V(e,a=!1,n=!0){const r=Ca(e);return a||(r.equals=ts),Xa&&n&&Te!==null&&Te.l!==null&&(Te.l.s??=[]).push(r),r}function cn(e,a){return C(e,c(()=>t(e))),a}function C(e,a,n=!1){pe!==null&&(!Ut||(pe.f&Sr)!==0)&&bn()&&(pe.f&(lt|wa|Un|Sr))!==0&&!sa?.includes(e)&&di();let r=n?Ga(a):a;return Wa(e,r)}function Wa(e,a){if(!e.equals(a)){var n=e.v;Ma?ha.set(e,a):ha.set(e,n),e.v=a;var r=Vt.ensure();r.capture(e,n),(e.f&lt)!==0&&((e.f&kt)!==0&&_r(e),nt(e,(e.f&At)===0?Je:oa)),e.wv=$s(),us(e,kt),bn()&&ve!==null&&(ve.f&Je)!==0&&(ve.f&(ia|Ra))===0&&($t===null?to([e]):$t.push(e))}return a}function dn(e){C(e,e.v+1)}function us(e,a){var n=e.reactions;if(n!==null)for(var r=bn(),s=n.length,i=0;i<s;i++){var o=n[i],v=o.f;if(!(!r&&o===ve)){var l=(v&kt)===0;l&&nt(o,a),(v&lt)!==0?us(o,oa):l&&((v&wa)!==0&&Ea!==null&&Ea.push(o),Aa(o))}}}function Ga(e){if(typeof e!="object"||e===null||ra in e)return e;const a=dr(e);if(a!==Ys&&a!==Zs)return e;var n=new Map,r=hn(e),s=pa(0),i=$a,o=v=>{if($a===i)return v();var l=pe,u=$a;mt(null),Rr(i);var g=v();return mt(l),Rr(u),g};return r&&n.set("length",pa(e.length)),new Proxy(e,{defineProperty(v,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&ui();var g=n.get(l);return g===void 0?g=o(()=>{var q=pa(u.value);return n.set(l,q),q}):C(g,u.value,!0),!0},deleteProperty(v,l){var u=n.get(l);if(u===void 0){if(l in v){const g=o(()=>pa(Ze));n.set(l,g),dn(s)}}else C(u,Ze),dn(s);return!0},get(v,l,u){if(l===ra)return e;var g=n.get(l),q=l in v;if(g===void 0&&(!q||qa(v,l)?.writable)&&(g=o(()=>{var b=Ga(q?v[l]:Ze),p=pa(b);return p}),n.set(l,g)),g!==void 0){var y=t(g);return y===Ze?void 0:y}return Reflect.get(v,l,u)},getOwnPropertyDescriptor(v,l){var u=Reflect.getOwnPropertyDescriptor(v,l);if(u&&"value"in u){var g=n.get(l);g&&(u.value=t(g))}else if(u===void 0){var q=n.get(l),y=q?.v;if(q!==void 0&&y!==Ze)return{enumerable:!0,configurable:!0,value:y,writable:!0}}return u},has(v,l){if(l===ra)return!0;var u=n.get(l),g=u!==void 0&&u.v!==Ze||Reflect.has(v,l);if(u!==void 0||ve!==null&&(!g||qa(v,l)?.writable)){u===void 0&&(u=o(()=>{var y=g?Ga(v[l]):Ze,b=pa(y);return b}),n.set(l,u));var q=t(u);if(q===Ze)return!1}return g},set(v,l,u,g){var q=n.get(l),y=l in v;if(r&&l==="length")for(var b=u;b<q.v;b+=1){var p=n.get(b+"");p!==void 0?C(p,Ze):b in v&&(p=o(()=>pa(Ze)),n.set(b+"",p))}if(q===void 0)(!y||qa(v,l)?.writable)&&(q=o(()=>pa(void 0)),C(q,Ga(u)),n.set(l,q));else{y=q.v!==Ze;var h=o(()=>Ga(u));C(q,h)}var S=Reflect.getOwnPropertyDescriptor(v,l);if(S?.set&&S.set.call(g,u),!y){if(r&&typeof l=="string"){var f=n.get("length"),T=Number(l);Number.isInteger(T)&&T>=f.v&&C(f,T+1)}dn(s)}return!0},ownKeys(v){t(s);var l=Reflect.ownKeys(v).filter(q=>{var y=n.get(q);return y===void 0||y.v!==Ze});for(var[u,g]of n)g.v!==Ze&&!(u in v)&&l.push(u);return l},setPrototypeOf(){vi()}})}function Ar(e){try{if(e!==null&&typeof e=="object"&&ra in e)return e[ra]}catch{}return e}function Qi(e,a){return Object.is(Ar(e),Ar(a))}var Mn,vs,ds,fs;function Ki(){if(Mn===void 0){Mn=window,vs=/Firefox/.test(navigator.userAgent);var e=Element.prototype,a=Node.prototype,n=Text.prototype;ds=qa(a,"firstChild").get,fs=qa(a,"nextSibling").get,qr(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),qr(n)&&(n.__t=void 0)}}function en(e=""){return document.createTextNode(e)}function _a(e){return ds.call(e)}function xn(e){return fs.call(e)}function d(e,a){return _a(e)}function Se(e,a=!1){{var n=_a(e);return n instanceof Comment&&n.data===""?xn(n):n}}function _(e,a=1,n=!1){let r=e;for(;a--;)r=xn(r);return r}function zi(e){e.textContent=""}function ps(){return!1}let Cr=!1;function Vi(){Cr||(Cr=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const a of e.target.elements)a.__on_r?.()})},{capture:!0}))}function tn(e){var a=pe,n=ve;mt(null),Yt(null);try{return e()}finally{mt(a),Yt(n)}}function ms(e,a,n,r=n){e.addEventListener(a,()=>tn(n));const s=e.__on_r;s?e.__on_r=()=>{s(),r(!0)}:e.__on_r=()=>r(!0),Vi()}function _s(e){ve===null&&pe===null&&oi(),pe!==null&&(pe.f&At)!==0&&ve===null&&ii(),Ma&&si()}function Wi(e,a){var n=a.last;n===null?a.last=a.first=e:(n.next=e,e.prev=n,a.last=e)}function Zt(e,a,n,r=!0){var s=ve;s!==null&&(s.f&Ht)!==0&&(e|=Ht);var i={ctx:Te,deps:null,nodes_start:null,nodes_end:null,f:e|kt,first:null,fn:a,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Ya(i),i.f|=Fn}catch(l){throw Ct(i),l}else a!==null&&Aa(i);if(r){var o=i;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&Ja)===0&&(o=o.first),o!==null&&(o.parent=s,s!==null&&Wi(o,s),pe!==null&&(pe.f&lt)!==0&&(e&Ra)===0)){var v=pe;(v.effects??=[]).push(o)}}return i}function Yi(){return pe!==null&&!Ut}function En(e){const a=Zt(On,null,!1);return nt(a,Je),a.teardown=e,a}function ir(e){_s();var a=ve.f,n=!pe&&(a&ia)!==0&&(a&Fn)===0;if(n){var r=Te;(r.e??=[]).push(e)}else return gs(e)}function gs(e){return Zt(fr|Zr,e,!1)}function Zi(e){return _s(),Zt(On|Zr,e,!0)}function Ji(e){Vt.ensure();const a=Zt(Ra|Ja,e,!0);return(n={})=>new Promise(r=>{n.outro?Qa(a,()=>{Ct(a),r(void 0)}):(Ct(a),r(void 0))})}function hs(e){return Zt(fr,e,!1)}function tt(e,a){var n=Te,r={effect:null,ran:!1,deps:e};n.l.$.push(r),r.effect=an(()=>{e(),!r.ran&&(r.ran=!0,c(a))})}function gr(){var e=Te;an(()=>{for(var a of e.l.$){a.deps();var n=a.effect;(n.f&Je)!==0&&nt(n,oa),kn(n)&&Ya(n),a.ran=!1}})}function Xi(e){return Zt(Un|Ja,e,!0)}function an(e,a=0){return Zt(On|a,e,!0)}function F(e,a=[],n=[]){Fi(a,n,r=>{Zt(On,()=>e(...r.map(t)),!0)})}function hr(e,a=0){var n=Zt(wa|a,e,!0);return n}function Nt(e,a=!0){return Zt(ia|Ja,e,!0,a)}function ws(e){var a=e.teardown;if(a!==null){const n=Ma,r=pe;Ir(!0),mt(null);try{a.call(null)}finally{Ir(n),mt(r)}}}function bs(e,a=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const s=n.ac;s!==null&&tn(()=>{s.abort(Ha)});var r=n.next;(n.f&Ra)!==0?n.parent=null:Ct(n,a),n=r}}function eo(e){for(var a=e.first;a!==null;){var n=a.next;(a.f&ia)===0&&Ct(a),a=n}}function Ct(e,a=!0){var n=!1;(a||(e.f&ti)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(ys(e.nodes_start,e.nodes_end),n=!0),bs(e,a&&!n),Pn(e,0),nt(e,Da);var r=e.transitions;if(r!==null)for(const i of r)i.stop();ws(e);var s=e.parent;s!==null&&s.first!==null&&xs(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function ys(e,a){for(;e!==null;){var n=e===a?null:xn(e);e.remove(),e=n}}function xs(e){var a=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),a!==null&&(a.first===e&&(a.first=r),a.last===e&&(a.last=n))}function Qa(e,a){var n=[];wr(e,n,!0),Es(n,()=>{Ct(e),a&&a()})}function Es(e,a){var n=e.length;if(n>0){var r=()=>--n||a();for(var s of e)s.out(r)}else a()}function wr(e,a,n){if((e.f&Ht)===0){if(e.f^=Ht,e.transitions!==null)for(const o of e.transitions)(o.is_global||n)&&a.push(o);for(var r=e.first;r!==null;){var s=r.next,i=(r.f&wn)!==0||(r.f&ia)!==0;wr(r,a,i?n:!1),r=s}}}function br(e){ks(e,!0)}function ks(e,a){if((e.f&Ht)!==0){e.f^=Ht,(e.f&Je)===0&&(nt(e,kt),Aa(e));for(var n=e.first;n!==null;){var r=n.next,s=(n.f&wn)!==0||(n.f&ia)!==0;ks(n,s?a:!1),n=r}if(e.transitions!==null)for(const i of e.transitions)(i.is_global||a)&&i.in()}}let Ka=!1;function Tr(e){Ka=e}let Ma=!1;function Ir(e){Ma=e}let pe=null,Ut=!1;function mt(e){pe=e}let ve=null;function Yt(e){ve=e}let sa=null;function qs(e){pe!==null&&(sa===null?sa=[e]:sa.push(e))}let ot=null,xt=0,$t=null;function to(e){$t=e}let Ss=1,mn=0,$a=mn;function Rr(e){$a=e}let ga=!1;function $s(){return++Ss}function kn(e){var a=e.f;if((a&kt)!==0)return!0;if((a&oa)!==0){var n=e.deps,r=(a&At)!==0;if(n!==null){var s,i,o=(a&Dn)!==0,v=r&&ve!==null&&!ga,l=n.length;if((o||v)&&(ve===null||(ve.f&Da)===0)){var u=e,g=u.parent;for(s=0;s<l;s++)i=n[s],(o||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);o&&(u.f^=Dn),v&&g!==null&&(g.f&At)===0&&(u.f^=At)}for(s=0;s<l;s++)if(i=n[s],kn(i)&&cs(i),i.wv>e.wv)return!0}(!r||ve!==null&&!ga)&&nt(e,Je)}return!1}function As(e,a,n=!0){var r=e.reactions;if(r!==null&&!sa?.includes(e))for(var s=0;s<r.length;s++){var i=r[s];(i.f&lt)!==0?As(i,a,!1):a===i&&(n?nt(i,kt):(i.f&Je)!==0&&nt(i,oa),Aa(i))}}function Cs(e){var a=ot,n=xt,r=$t,s=pe,i=ga,o=sa,v=Te,l=Ut,u=$a,g=e.f;ot=null,xt=0,$t=null,ga=(g&At)!==0&&(Ut||!Ka||pe===null),pe=(g&(ia|Ra))===0?e:null,sa=null,za(e.ctx),Ut=!1,$a=++mn,e.ac!==null&&(tn(()=>{e.ac.abort(Ha)}),e.ac=null);try{e.f|=ar;var q=e.fn,y=q(),b=e.deps;if(ot!==null){var p;if(Pn(e,xt),b!==null&&xt>0)for(b.length=xt+ot.length,p=0;p<ot.length;p++)b[xt+p]=ot[p];else e.deps=b=ot;if(!ga||(g&lt)!==0&&e.reactions!==null)for(p=xt;p<b.length;p++)(b[p].reactions??=[]).push(e)}else b!==null&&xt<b.length&&(Pn(e,xt),b.length=xt);if(bn()&&$t!==null&&!Ut&&b!==null&&(e.f&(lt|oa|kt))===0)for(p=0;p<$t.length;p++)As($t[p],e);return s!==null&&s!==e&&(mn++,$t!==null&&(r===null?r=$t:r.push(...$t))),(e.f&Sa)!==0&&(e.f^=Sa),y}catch(h){return ns(h)}finally{e.f^=ar,ot=a,xt=n,$t=r,pe=s,ga=i,sa=o,za(v),Ut=l,$a=u}}function ao(e,a){let n=a.reactions;if(n!==null){var r=Ws.call(n,e);if(r!==-1){var s=n.length-1;s===0?n=a.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(a.f&lt)!==0&&(ot===null||!ot.includes(a))&&(nt(a,oa),(a.f&(At|Dn))===0&&(a.f^=Dn),ls(a),Pn(a,0))}function Pn(e,a){var n=e.deps;if(n!==null)for(var r=a;r<n.length;r++)ao(e,n[r])}function Ya(e){var a=e.f;if((a&Da)===0){nt(e,Je);var n=ve,r=Ka;ve=e,Ka=!0;try{(a&wa)!==0?eo(e):bs(e),ws(e);var s=Cs(e);e.teardown=typeof s=="function"?s:null,e.wv=Ss;var i;Vr&&Ci&&(e.f&kt)!==0&&e.deps}finally{Ka=r,ve=n}}}async function Tn(){await Promise.resolve(),Di()}function t(e){var a=e.f,n=(a&lt)!==0;if(pe!==null&&!Ut){var r=ve!==null&&(ve.f&Da)!==0;if(!r&&!sa?.includes(e)){var s=pe.deps;if((pe.f&ar)!==0)e.rv<mn&&(e.rv=mn,ot===null&&s!==null&&s[xt]===e?xt++:ot===null?ot=[e]:(!ga||!ot.includes(e))&&ot.push(e));else{(pe.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[pe]:i.includes(pe)||i.push(pe)}}}else if(n&&e.deps===null&&e.effects===null){var o=e,v=o.parent;v!==null&&(v.f&At)===0&&(o.f^=At)}if(Ma){if(ha.has(e))return ha.get(e);if(n){o=e;var l=o.v;return((o.f&Je)===0&&o.reactions!==null||Ts(o))&&(l=_r(o)),ha.set(o,l),l}}else if(n){if(o=e,Ot?.has(o))return Ot.get(o);kn(o)&&cs(o)}if(Ot?.has(e))return Ot.get(e);if((e.f&Sa)!==0)throw e.v;return e.v}function Ts(e){if(e.v===Ze)return!0;if(e.deps===null)return!1;for(const a of e.deps)if(ha.has(a)||(a.f&lt)!==0&&Ts(a))return!0;return!1}function c(e){var a=Ut;try{return Ut=!0,e()}finally{Ut=a}}const no=-7169;function nt(e,a){e.f=e.f&no|a}function Ae(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(ra in e)or(e);else if(!Array.isArray(e))for(let a in e){const n=e[a];typeof n=="object"&&n&&ra in n&&or(n)}}}function or(e,a=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!a.has(e)){a.add(e),e instanceof Date&&e.getTime();for(let r in e)try{or(e[r],a)}catch{}const n=dr(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Wr(n);for(let s in r){const i=r[s].get;if(i)try{i.call(e)}catch{}}}}}const ro=["touchstart","touchmove"];function so(e){return ro.includes(e)}const io=new Set,Dr=new Set;function oo(e,a,n,r={}){function s(i){if(r.capture||un.call(a,i),!i.cancelBubble)return tn(()=>n?.call(this,i))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Wt(()=>{a.addEventListener(e,s,r)}):a.addEventListener(e,s,r),s}function fe(e,a,n,r,s){var i={capture:r,passive:s},o=oo(e,a,n,i);(a===document.body||a===window||a===document||a instanceof HTMLMediaElement)&&En(()=>{a.removeEventListener(e,o,i)})}let Mr=null;function un(e){var a=this,n=a.ownerDocument,r=e.type,s=e.composedPath?.()||[],i=s[0]||e.target;Mr=e;var o=0,v=Mr===e&&e.__root;if(v){var l=s.indexOf(v);if(l!==-1&&(a===document||a===window)){e.__root=a;return}var u=s.indexOf(a);if(u===-1)return;l<=u&&(o=l)}if(i=s[o]||e.target,i!==a){In(e,"currentTarget",{configurable:!0,get(){return i||n}});var g=pe,q=ve;mt(null),Yt(null);try{for(var y,b=[];i!==null;){var p=i.assignedSlot||i.parentNode||i.host||null;try{var h=i["__"+r];if(h!=null&&(!i.disabled||e.target===i))if(hn(h)){var[S,...f]=h;S.apply(i,[e,...f])}else h.call(i,e)}catch(T){y?b.push(T):y=T}if(e.cancelBubble||p===a||p===null)break;i=p}if(y){for(let T of b)queueMicrotask(()=>{throw T});throw y}}finally{e.__root=a,delete e.currentTarget,mt(g),Yt(q)}}}function Is(e){var a=document.createElement("template");return a.innerHTML=e.replaceAll("<!>","<!---->"),a.content}function _n(e,a){var n=ve;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=a)}function E(e,a){var n=(a&ki)!==0,r=(a&qi)!==0,s,i=!e.startsWith("<!>");return()=>{s===void 0&&(s=Is(i?e:"<!>"+e),n||(s=_a(s)));var o=r||vs?document.importNode(s,!0):s.cloneNode(!0);if(n){var v=_a(o),l=o.lastChild;_n(v,l)}else _n(o,o);return o}}function Fe(e=""){{var a=en(e+"");return _n(a,a),a}}function Ke(){var e=document.createDocumentFragment(),a=document.createComment(""),n=en();return e.append(a,n),_n(a,n),e}function m(e,a){e!==null&&e.before(a)}let lr=!0;function A(e,a){var n=a==null?"":typeof a=="object"?a+"":a;n!==(e.__t??=e.nodeValue)&&(e.__t=n,e.nodeValue=n+"")}function ma(e,a){return lo(e,a)}const Oa=new Map;function lo(e,{target:a,anchor:n,props:r={},events:s,context:i,intro:o=!0}){Ki();var v=new Set,l=q=>{for(var y=0;y<q.length;y++){var b=q[y];if(!v.has(b)){v.add(b);var p=so(b);a.addEventListener(b,un,{passive:p});var h=Oa.get(b);h===void 0?(document.addEventListener(b,un,{passive:p}),Oa.set(b,1)):Oa.set(b,h+1)}}};l(vr(io)),Dr.add(l);var u=void 0,g=Ji(()=>{var q=n??a.appendChild(en());return Li(q,{pending:()=>{}},y=>{if(i){rt({});var b=Te;b.c=i}s&&(r.$$events=s),lr=o,u=e(y,r)||{},lr=!0,i&&st()}),()=>{for(var y of v){a.removeEventListener(y,un);var b=Oa.get(y);--b===0?(document.removeEventListener(y,un),Oa.delete(y)):Oa.set(y,b)}Dr.delete(l),q!==n&&q.parentNode?.removeChild(q)}});return co.set(u,g),u}let co=new WeakMap;function M(e,a,n=!1){var r=e,s=null,i=null,o=Ze,v=n?wn:0,l=!1;const u=(b,p=!0)=>{l=!0,y(p,b)};var g=null;function q(){g!==null&&(g.lastChild.remove(),r.before(g),g=null);var b=o?s:i,p=o?i:s;b&&br(b),p&&Qa(p,()=>{o?i=null:s=null})}const y=(b,p)=>{if(o!==(o=b)){var h=ps(),S=r;if(h&&(g=document.createDocumentFragment(),g.append(S=en())),o?s??=p&&Nt(()=>p(S)):i??=p&&Nt(()=>p(S)),h){var f=De,T=o?s:i,I=o?i:s;T&&f.skipped_effects.delete(T),I&&f.skipped_effects.add(I),f.add_callback(q)}else q()}};hr(()=>{l=!1,a(u),l||y(null,null)},v)}function _t(e,a){return a}function uo(e,a,n){for(var r=e.items,s=[],i=a.length,o=0;o<i;o++)wr(a[o].e,s,!0);var v=i>0&&s.length===0&&n!==null;if(v){var l=n.parentNode;zi(l),l.append(n),r.clear(),Kt(e,a[0].prev,a[i-1].next)}Es(s,()=>{for(var u=0;u<i;u++){var g=a[u];v||(r.delete(g.k),Kt(e,g.prev,g.next)),Ct(g.e,!v)}})}function Ge(e,a,n,r,s,i=null){var o=e,v={flags:a,items:new Map,first:null},l=(a&Jr)!==0;if(l){var u=e;o=u.appendChild(en())}var g=null,q=!1,y=new Map,b=Ft(()=>{var f=n();return hn(f)?f:f==null?[]:vr(f)}),p,h;function S(){vo(h,p,v,y,o,s,a,r,n),i!==null&&(p.length===0?g?br(g):g=Nt(()=>i(o)):g!==null&&Qa(g,()=>{g=null}))}hr(()=>{h??=ve,p=t(b);var f=p.length;if(!(q&&f===0)){q=f===0;var T,I,O,P;if(ps()){var k=new Set,j=De;for(I=0;I<f;I+=1){O=p[I],P=r(O,I);var $=v.items.get(P)??y.get(P);$?(a&(Hn|Gn))!==0&&Rs($,O,I,a):(T=Ds(null,v,null,null,O,P,I,s,a,n,!0),y.set(P,T)),k.add(P)}for(const[R,Q]of v.items)k.has(R)||j.skipped_effects.add(Q.e);j.add_callback(S)}else S();t(b)}})}function vo(e,a,n,r,s,i,o,v,l){var u=(o&pi)!==0,g=(o&(Hn|Gn))!==0,q=a.length,y=n.items,b=n.first,p=b,h,S=null,f,T=[],I=[],O,P,k,j;if(u)for(j=0;j<q;j+=1)O=a[j],P=v(O,j),k=y.get(P),k!==void 0&&(k.a?.measure(),(f??=new Set).add(k));for(j=0;j<q;j+=1){if(O=a[j],P=v(O,j),k=y.get(P),k===void 0){var $=r.get(P);if($!==void 0){r.delete(P),y.set(P,$);var R=S?S.next:p;Kt(n,S,$),Kt(n,$,R),Jn($,R,s),S=$}else{var Q=p?p.e.nodes_start:s;S=Ds(Q,n,S,S===null?n.first:S.next,O,P,j,i,o,l)}y.set(P,S),T=[],I=[],p=S.next;continue}if(g&&Rs(k,O,j,o),(k.e.f&Ht)!==0&&(br(k.e),u&&(k.a?.unfix(),(f??=new Set).delete(k))),k!==p){if(h!==void 0&&h.has(k)){if(T.length<I.length){var K=I[0],J;S=K.prev;var ae=T[0],U=T[T.length-1];for(J=0;J<T.length;J+=1)Jn(T[J],K,s);for(J=0;J<I.length;J+=1)h.delete(I[J]);Kt(n,ae.prev,U.next),Kt(n,S,ae),Kt(n,U,K),p=K,S=U,j-=1,T=[],I=[]}else h.delete(k),Jn(k,p,s),Kt(n,k.prev,k.next),Kt(n,k,S===null?n.first:S.next),Kt(n,S,k),S=k;continue}for(T=[],I=[];p!==null&&p.k!==P;)(p.e.f&Ht)===0&&(h??=new Set).add(p),I.push(p),p=p.next;if(p===null)continue;k=p}T.push(k),S=k,p=k.next}if(p!==null||h!==void 0){for(var H=h===void 0?[]:vr(h);p!==null;)(p.e.f&Ht)===0&&H.push(p),p=p.next;var G=H.length;if(G>0){var Y=(o&Jr)!==0&&q===0?s:null;if(u){for(j=0;j<G;j+=1)H[j].a?.measure();for(j=0;j<G;j+=1)H[j].a?.fix()}uo(n,H,Y)}}u&&Wt(()=>{if(f!==void 0)for(k of f)k.a?.apply()}),e.first=n.first&&n.first.e,e.last=S&&S.e;for(var W of r.values())Ct(W.e);r.clear()}function Rs(e,a,n,r){(r&Hn)!==0&&Wa(e.v,a),(r&Gn)!==0?Wa(e.i,n):e.i=n}function Ds(e,a,n,r,s,i,o,v,l,u,g){var q=(l&Hn)!==0,y=(l&mi)===0,b=q?y?V(s,!1,!1):Ca(s):s,p=(l&Gn)===0?o:Ca(o),h={i:p,v:b,k:i,a:null,e:null,prev:n,next:r};try{if(e===null){var S=document.createDocumentFragment();S.append(e=en())}return h.e=Nt(()=>v(e,b,p,u),Ai),h.e.prev=n&&n.e,h.e.next=r&&r.e,n===null?g||(a.first=h):(n.next=h,n.e.next=h.e),r!==null&&(r.prev=h,r.e.prev=h.e),h}finally{}}function Jn(e,a,n){for(var r=e.next?e.next.e.nodes_start:n,s=a?a.e.nodes_start:n,i=e.e.nodes_start;i!==null&&i!==r;){var o=xn(i);s.before(i),i=o}}function Kt(e,a,n){a===null?e.first=n:(a.next=n,a.e.next=n&&n.e),n!==null&&(n.prev=a,n.e.prev=a&&a.e)}function Ms(e,a,n=!1,r=!1,s=!1){var i=e,o="";F(()=>{var v=ve;if(o!==(o=a()??"")&&(v.nodes_start!==null&&(ys(v.nodes_start,v.nodes_end),v.nodes_start=v.nodes_end=null),o!=="")){var l=o+"";n?l=`<svg>${l}</svg>`:r&&(l=`<math>${l}</math>`);var u=Is(l);if((n||r)&&(u=_a(u)),_n(_a(u),u.lastChild),n||r)for(;_a(u);)i.before(_a(u));else i.before(u)}})}const Pr=[...` 	
\r\f¬†\v\uFEFF`];function fo(e,a,n){var r=e==null?"":""+e;if(a&&(r=r?r+" "+a:a),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var v=o+i;(o===0||Pr.includes(r[o-1]))&&(v===r.length||Pr.includes(r[v]))?r=(o===0?"":r.substring(0,o))+r.substring(v+1):o=v}}return r===""?null:r}function po(e,a){return e==null?null:String(e)}function ge(e,a,n,r,s,i){var o=e.__className;if(o!==n||o===void 0){var v=fo(n,r,i);v==null?e.removeAttribute("class"):e.className=v,e.__className=n}else if(i&&s!==i)for(var l in i){var u=!!i[l];(s==null||u!==!!s[l])&&e.classList.toggle(l,u)}return i}function Ps(e,a,n,r){var s=e.__style;if(s!==a){var i=po(a);i==null?e.removeAttribute("style"):e.style.cssText=i,e.__style=a}return r}const mo=Symbol("is custom element"),_o=Symbol("is html");function Ba(e,a,n,r){var s=go(e);s[a]!==(s[a]=n)&&(a==="loading"&&(e[ni]=n),n==null?e.removeAttribute(a):typeof n!="string"&&ho(e).includes(a)?e[a]=n:e.setAttribute(a,n))}function go(e){return e.__attributes??={[mo]:e.nodeName.includes("-"),[_o]:e.namespaceURI===Si}}var jr=new Map;function ho(e){var a=e.getAttribute("is")||e.nodeName,n=jr.get(a);if(n)return n;jr.set(a,n=[]);for(var r,s=e,i=Element.prototype;i!==s;){r=Wr(s);for(var o in r)r[o].set&&n.push(o);s=dr(s)}return n}const wo=()=>performance.now(),na={tick:e=>requestAnimationFrame(e),now:()=>wo(),tasks:new Set};function js(){const e=na.now();na.tasks.forEach(a=>{a.c(e)||(na.tasks.delete(a),a.f())}),na.tasks.size!==0&&na.tick(js)}function bo(e){let a;return na.tasks.size===0&&na.tick(js),{promise:new Promise(n=>{na.tasks.add(a={c:e,f:n})}),abort(){na.tasks.delete(a)}}}function $n(e,a){tn(()=>{e.dispatchEvent(new CustomEvent(a))})}function yo(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const a=e.split("-");return a.length===1?a[0]:a[0]+a.slice(1).map(n=>n[0].toUpperCase()+n.slice(1)).join("")}function Lr(e){const a={},n=e.split(";");for(const r of n){const[s,i]=r.split(":");if(!s||i===void 0)break;const o=yo(s.trim());a[o]=i.trim()}return a}const xo=e=>e;function qe(e,a,n,r){var s=(e&yi)!==0,i=(e&xi)!==0,o=s&&i,v=(e&Ei)!==0,l=o?"both":s?"in":"out",u,g=a.inert,q=a.style.overflow,y,b;function p(){return tn(()=>u??=n()(a,r?.()??{},{direction:l}))}var h={is_global:v,in(){if(a.inert=g,!s){b?.abort(),b?.reset?.();return}i||y?.abort(),$n(a,"introstart"),y=cr(a,p(),b,1,()=>{$n(a,"introend"),y?.abort(),y=u=void 0,a.style.overflow=q})},out(I){if(!i){I?.(),u=void 0;return}a.inert=!0,$n(a,"outrostart"),b=cr(a,p(),y,0,()=>{$n(a,"outroend"),I?.()})},stop:()=>{y?.abort(),b?.abort()}},S=ve;if((S.transitions??=[]).push(h),s&&lr){var f=v;if(!f){for(var T=S.parent;T&&(T.f&wn)!==0;)for(;(T=T.parent)&&(T.f&wa)===0;);f=!T||(T.f&Fn)!==0}f&&hs(()=>{c(()=>h.in())})}}function cr(e,a,n,r,s){var i=r===1;if(Js(a)){var o,v=!1;return Wt(()=>{if(!v){var S=a({direction:i?"in":"out"});o=cr(e,S,n,r,s)}}),{abort:()=>{v=!0,o?.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(n?.deactivate(),!a?.duration)return s(),{abort:Et,deactivate:Et,reset:Et,t:()=>r};const{delay:l=0,css:u,tick:g,easing:q=xo}=a;var y=[];if(i&&n===void 0&&(g&&g(0,1),u)){var b=Lr(u(0,1));y.push(b,b)}var p=()=>1-r,h=e.animate(y,{duration:l,fill:"forwards"});return h.onfinish=()=>{h.cancel();var S=n?.t()??1-r;n?.abort();var f=r-S,T=a.duration*Math.abs(f),I=[];if(T>0){var O=!1;if(u)for(var P=Math.ceil(T/16.666666666666668),k=0;k<=P;k+=1){var j=S+f*q(k/P),$=Lr(u(j,1-j));I.push($),O||=$.overflow==="hidden"}O&&(e.style.overflow="hidden"),p=()=>{var R=h.currentTime;return S+f*q(R/T)},g&&bo(()=>{if(h.playState!=="running")return!1;var R=p();return g(R,1-R),!0})}h=e.animate(I,{duration:T,fill:"forwards"}),h.onfinish=()=>{p=()=>r,g?.(r,1-r),s()}},{abort:()=>{h&&(h.cancel(),h.effect=null,h.onfinish=Et)},deactivate:()=>{s=Et},reset:()=>{r===0&&g?.(1,0)},t:()=>p()}}function Ls(e,a,n=a){var r=new WeakSet;ms(e,"input",async s=>{var i=s?e.defaultValue:e.value;if(i=er(e)?tr(i):i,n(i),De!==null&&r.add(De),await Tn(),i!==(i=a())){var o=e.selectionStart,v=e.selectionEnd,l=e.value.length;if(e.value=i??"",v!==null){var u=e.value.length;o===v&&v===l&&u>l?(e.selectionStart=u,e.selectionEnd=u):(e.selectionStart=o,e.selectionEnd=Math.min(v,u))}}}),c(a)==null&&e.value&&(n(er(e)?tr(e.value):e.value),De!==null&&r.add(De)),an(()=>{var s=a();if(e===document.activeElement){var i=Cn??De;if(r.has(i))return}er(e)&&s===tr(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}const Xn=new Set;function Eo(e,a,n,r,s=r){var i=n.getAttribute("type")==="checkbox",o=e;if(a!==null)for(var v of a)o=o[v]??=[];o.push(n),ms(n,"change",()=>{var l=n.__value;i&&(l=ko(o,l,n.checked)),s(l)},()=>s(i?[]:null)),an(()=>{var l=r();i?(l=l||[],n.checked=l.includes(n.__value)):n.checked=Qi(n.__value,l)}),En(()=>{var l=o.indexOf(n);l!==-1&&o.splice(l,1)}),Xn.has(o)||(Xn.add(o),Wt(()=>{o.sort((l,u)=>l.compareDocumentPosition(u)===4?-1:1),Xn.delete(o)})),Wt(()=>{})}function ko(e,a,n){for(var r=new Set,s=0;s<e.length;s+=1)e[s].checked&&r.add(e[s].__value);return n||r.delete(a),Array.from(r)}function er(e){var a=e.type;return a==="number"||a==="range"}function tr(e){return e===""?null:+e}function qo(e,a,n){var r=qa(e,a);r&&r.set&&(e[a]=n,En(()=>{e[a]=null}))}function Nr(e,a){return e===a||e?.[ra]===a}function So(e={},a,n,r){return hs(()=>{var s,i;return an(()=>{s=i,i=[],c(()=>{e!==n(...i)&&(a(e,...i),s&&Nr(n(...s),e)&&a(null,...s))})}),()=>{Wt(()=>{i&&Nr(n(...i),e)&&a(null,...i)})}}),e}function Ns(e){return function(...a){var n=a[0];return n.stopPropagation(),e?.apply(this,a)}}function ct(e=!1){const a=Te,n=a.l.u;if(!n)return;let r=()=>Ae(a.s);if(e){let s=0,i={};const o=yn(()=>{let v=!1;const l=a.s;for(const u in l)l[u]!==i[u]&&(i[u]=l[u],v=!0);return v&&s++,s});r=()=>t(o)}n.b.length&&Zi(()=>{Or(a,r),Rn(n.b)}),ir(()=>{const s=c(()=>n.m.map(Xs));return()=>{for(const i of s)typeof i=="function"&&i()}}),n.a.length&&ir(()=>{Or(a,r),Rn(n.a)})}function Or(e,a){if(e.l.s)for(const n of e.l.s)t(n);a()}function Os(e,a){var n=e.$$events?.[a.type],r=hn(n)?n.slice():n==null?[]:[n];for(var s of r)s.call(this,a)}function yr(e,a,n){if(e==null)return a(void 0),n&&n(void 0),Et;const r=c(()=>e.subscribe(a,n));return r.unsubscribe?()=>r.unsubscribe():r}const Fa=[];function $o(e,a){return{subscribe:nn(e,a).subscribe}}function nn(e,a=Et){let n=null;const r=new Set;function s(v){if(es(e,v)&&(e=v,n)){const l=!Fa.length;for(const u of r)u[1](),Fa.push(u,e);if(l){for(let u=0;u<Fa.length;u+=2)Fa[u][0](Fa[u+1]);Fa.length=0}}}function i(v){s(v(e))}function o(v,l=Et){const u=[v,l];return r.add(u),r.size===1&&(n=a(s,i)||Et),v(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:o}}function fn(e,a,n){const r=!Array.isArray(e),s=r?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=a.length<2;return $o(n,(o,v)=>{let l=!1;const u=[];let g=0,q=Et;const y=()=>{if(g)return;q();const p=a(r?u[0]:u,o,v);i?o(p):q=typeof p=="function"?p:Et},b=s.map((p,h)=>yr(p,S=>{u[h]=S,g&=~(1<<h),l&&y()},()=>{g|=1<<h}));return l=!0,y(),function(){Rn(b),q(),l=!1}})}function xr(e){let a;return yr(e,n=>a=n)(),a}let An=!1,ur=Symbol();function aa(e,a,n){const r=n[a]??={store:null,source:V(void 0),unsubscribe:Et};if(r.store!==e&&!(ur in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=Et;else{var s=!0;r.unsubscribe=yr(e,i=>{s?r.source.v=i:C(r.source,i)}),s=!1}return e&&ur in n?xr(e):t(r.source)}function Er(){const e={};function a(){En(()=>{for(var n in e)e[n].unsubscribe();In(e,ur,{enumerable:!1,value:!0})})}return[e,a]}function Ao(e){var a=An;try{return An=!1,[e(),An]}finally{An=a}}function Be(e,a,n,r){var s=!Xa||(n&gi)!==0,i=(n&wi)!==0,o=(n&bi)!==0,v=r,l=!0,u=()=>(l&&(l=!1,v=o?c(r):r),v),g;if(i){var q=ra in e||ai in e;g=qa(e,a)?.set??(q&&a in e?I=>e[a]=I:void 0)}var y,b=!1;i?[y,b]=Ao(()=>e[a]):y=e[a],y===void 0&&r!==void 0&&(y=u(),g&&(s&&ci(),g(y)));var p;if(s?p=()=>{var I=e[a];return I===void 0?u():(l=!0,I)}:p=()=>{var I=e[a];return I!==void 0&&(v=void 0),I===void 0?v:I},s&&(n&hi)===0)return p;if(g){var h=e.$$legacy;return(function(I,O){return arguments.length>0?((!s||!O||h||b)&&g(O?p():I),I):p()})}var S=!1,f=((n&_i)!==0?yn:Ft)(()=>(S=!1,p()));i&&t(f);var T=ve;return(function(I,O){if(arguments.length>0){const P=O?t(f):s&&i?Ga(I):I;return C(f,P),S=!0,v!==void 0&&(v=P),I}return Ma&&S||(T.f&Da)!==0?f.v:t(f)})}function gt(e){Te===null&&mr(),Xa&&Te.l!==null?Io(Te).m.push(e):ir(()=>{const a=c(e);if(typeof a=="function")return a})}function Fs(e){Te===null&&mr(),gt(()=>()=>c(e))}function Co(e,a,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:a,bubbles:n,cancelable:r})}function To(){const e=Te;return e===null&&mr(),(a,n,r)=>{const s=e.s.$$events?.[a];if(s){const i=hn(s)?s.slice():[s],o=Co(a,n,r);for(const v of i)v.call(e.x,o);return!o.defaultPrevented}return!0}}function Io(e){var a=e.l;return a.u??={a:[],b:[],m:[]}}const Ro="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ro);Ti();var Do=E('<div class="loading svelte-3intqm">Loading...</div>'),Mo=E('<div class="character-credits svelte-3intqm"><span class="char-name svelte-3intqm"> </span> <span class="credits-amount svelte-3intqm"> </span></div>'),Po=E('<div class="credits-display svelte-3intqm"><div class="total-credits svelte-3intqm"><span class="credits-label svelte-3intqm">Total Fund:</span> <span class="credits-amount svelte-3intqm"> </span></div> <div class="individual-credits svelte-3intqm"></div> <div><span class="sync-indicator svelte-3intqm">‚óè</span> <span class="sync-text svelte-3intqm"> </span></div></div>'),jo=E('<div class="party-credits svelte-3intqm"><h5 class="svelte-3intqm">Gold Pieces</h5> <!></div>');function Lo(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V([]),s=V(0),i=V(!0),o=V(!0);gt(async()=>{await v();const b=setInterval(v,5e3);return()=>clearInterval(b)});async function v(){try{const b=await fetch(`/dnd-api/dnd/state?campaign=${n()}`);if(!b.ok)throw new Error("Failed to load credits");const p=await b.json();C(r,Object.entries(p.characters||{}).map(([h,S])=>({id:h,name:S.name,credits:S.credits||0}))),C(s,t(r).reduce((h,S)=>h+S.credits,0)),C(i,!0),C(o,!1)}catch(b){console.error("Error loading credits:",b),C(i,!1),C(o,!1)}}function l(b){return b.toLocaleString()}ct();var u=jo(),g=_(d(u),2);{var q=b=>{var p=Do();m(b,p)},y=b=>{var p=Po(),h=d(p),S=_(d(h),2),f=d(S),T=_(h,2);Ge(T,5,()=>t(r),_t,(k,j)=>{var $=Mo(),R=d($),Q=d(R),K=_(R,2),J=d(K);F(ae=>{A(Q,`${t(j),c(()=>t(j).name)??""}:`),A(J,`${ae??""} GP`)},[()=>(t(j),c(()=>l(t(j).credits)))]),m(k,$)});var I=_(T,2),O=_(d(I),2),P=d(O);F(k=>{A(f,`${k??""} GP`),ge(I,1,`sync-status ${t(i)?"synced":"unsynced"}`,"svelte-3intqm"),A(P,t(i)?"Synced":"Syncing...")},[()=>(t(s),c(()=>l(t(s))))]),m(b,p)};M(g,b=>{t(o)?b(q):b(y,!1)})}m(e,u),st()}var No=E('<button><div class="party-card-name svelte-p6p5gl"> </div> <div class="party-card-class svelte-p6p5gl"> </div> <div class="party-card-vitals svelte-p6p5gl"><span class="hp svelte-p6p5gl"> </span> <span class="ac svelte-p6p5gl"> </span></div></button>'),Oo=E('<div class="ability-compact svelte-p6p5gl"><span class="ability-name svelte-p6p5gl"> </span> <span class="ability-value svelte-p6p5gl"> </span> <span> </span></div>'),Fo=E('<span class="condition-badge svelte-p6p5gl"> </span>'),Uo=E('<div class="conditions svelte-p6p5gl"><div class="conditions-label">Conditions:</div> <!></div>'),Ho=E('<div class="character-details"><h4 class="svelte-p6p5gl"> </h4> <div class="abilities-compact svelte-p6p5gl"></div> <div class="vitals-row svelte-p6p5gl"><div class="vital-stat hp-stat svelte-p6p5gl"><span class="vital-label svelte-p6p5gl">HP:</span> <span class="vital-value svelte-p6p5gl"> </span></div> <div class="vital-stat ac-stat svelte-p6p5gl"><span class="vital-label svelte-p6p5gl">AC:</span> <span class="vital-value svelte-p6p5gl"> </span></div></div> <!></div>'),Go=E('<div class="character-panel-content svelte-p6p5gl"><h3 class="svelte-p6p5gl">Party</h3> <!> <!> <!></div>');function Bo(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V([]),s=V(null),i=V({stats:{},equipment:[],inventory:[],spells:[],notes:""}),o=!0,v=null;async function l(){try{const h=await fetch(`/dnd-api/dnd/state?campaign=${n()}`);if(!h.ok)throw new Error("Failed to load campaign");const S=await h.json();C(r,Object.entries(S.characters||{}).map(([f,T])=>({id:f,name:T.name,hp:T.hp,ac:T.ac,level:T.level,class:T.class}))),t(r).length>0&&!t(s)&&C(s,t(r)[0].name)}catch(h){v=h.message,console.error("Error loading characters:",h)}}async function u(){if(t(s))try{o=!0;const h=encodeURIComponent(t(s)),S=await fetch(`/dnd-api/dnd/equipment/${h}?campaign=${n()}`);if(S.ok){const T=await S.json();cn(i,t(i).equipment=T.equipment||[]),cn(i,t(i).inventory=T.inventory||[]),cn(i,t(i).spells=T.spells||[])}const f=await fetch(`/dnd-api/dnd/state?campaign=${n()}`);if(f.ok){const T=await f.json(),I=Object.keys(T.characters).find(O=>T.characters[O].name===t(s));I&&cn(i,t(i).stats=T.characters[I])}v=null}catch(h){v=h.message,console.error("Error loading character data:",h)}finally{o=!1}}gt(async()=>{await l(),await u()}),tt(()=>t(s),()=>{t(s)&&(u(),window.dispatchEvent(new CustomEvent("characterSelected",{detail:{character:t(s)}})))}),gr(),ct();var g=Go(),q=_(d(g),2);Ge(q,1,()=>t(r),_t,(h,S)=>{var f=No();let T;var I=d(f),O=d(I),P=_(I,2),k=d(P),j=_(P,2),$=d(j),R=d($),Q=_($,2),K=d(Q);F(J=>{T=ge(f,1,"party-card svelte-p6p5gl",null,T,J),A(O,(t(S),c(()=>t(S).name))),A(k,`${t(S),c(()=>t(S).class)??""} ${t(S),c(()=>t(S).level)??""}`),A(R,`‚ù§Ô∏è ${t(S),c(()=>t(S).hp.current)??""}/${t(S),c(()=>t(S).hp.max)??""}`),A(K,`üõ°Ô∏è ${t(S),c(()=>t(S).ac)??""}`)},[()=>({selected:t(S).name===t(s)})]),fe("click",f,()=>C(s,t(S).name)),m(h,f)});var y=_(q,2);{var b=h=>{var S=Ho(),f=d(S),T=d(f),I=_(f,2);Ge(I,4,()=>["str","dex","con","int","wis","cha"],_t,(ae,U)=>{const H=Ft(()=>(t(i),c(()=>t(i).stats.abilities?.[U]||10))),G=Ft(()=>(Ae(t(H)),c(()=>Math.floor((t(H)-10)/2))));var Y=Oo(),W=d(Y),te=d(W),Z=_(W,2),he=d(Z),Le=_(Z,2);let Ue;var xe=d(Le);F((Ne,Pe)=>{A(te,Ne),A(he,t(H)),Ue=ge(Le,1,"ability-modifier svelte-p6p5gl",null,Ue,Pe),A(xe,`${t(G)>=0?"+":""}${t(G)??""}`)},[()=>c(()=>U.toUpperCase()),()=>({positive:t(G)>=0,negative:t(G)<0})]),m(ae,Y)});var O=_(I,2),P=d(O),k=_(d(P),2),j=d(k),$=_(P,2),R=_(d($),2),Q=d(R),K=_(O,2);{var J=ae=>{var U=Uo(),H=_(d(U),2);Ge(H,1,()=>(t(i),c(()=>t(i).stats.conditions)),_t,(G,Y)=>{var W=Fo(),te=d(W);F(()=>A(te,t(Y))),m(G,W)}),m(ae,U)};M(K,ae=>{t(i),c(()=>t(i).stats.conditions&&t(i).stats.conditions.length>0)&&ae(J)})}F(()=>{A(T,t(s)),A(j,`${t(i),c(()=>t(i).stats.hp?.current||0)??""}/${t(i),c(()=>t(i).stats.hp?.max||0)??""}`),A(Q,(t(i),c(()=>t(i).stats.ac||10)))}),m(h,S)};M(y,h=>{t(s),t(i),c(()=>t(s)&&t(i).stats)&&h(b)})}var p=_(y,2);Lo(p,{get campaign(){return n()}}),m(e,g),st()}var Qo=E('<div class="placeholder svelte-bbasel">Select a character to view their equipment</div>'),Ko=E('<div class="loading svelte-bbasel"> </div>'),zo=E('<div class="error svelte-bbasel"> </div>'),Vo=E('<span class="prop svelte-bbasel"> </span>'),Wo=E('<span class="prop svelte-bbasel"> </span>'),Yo=E('<span class="prop svelte-bbasel"> </span>'),Zo=E('<span class="prop-tags svelte-bbasel"> </span>'),Jo=E('<div class="item-properties svelte-bbasel"><!> <!> <!> <!></div>'),Xo=E('<div class="item equipment-item svelte-bbasel"><div class="item-main svelte-bbasel"><span class="item-name svelte-bbasel"> </span> <span class="item-type svelte-bbasel"> </span> <button class="btn-remove svelte-bbasel">√ó</button></div> <!></div>'),el=E('<p class="empty svelte-bbasel">No equipment</p>'),tl=E('<div class="items svelte-bbasel"></div>'),al=E('<span class="item-quantity svelte-bbasel"> </span>'),nl=E('<div class="item svelte-bbasel"><div class="item-main svelte-bbasel"><span class="item-name svelte-bbasel"> </span> <!></div></div>'),rl=E('<p class="empty svelte-bbasel">No items</p>'),sl=E('<div class="items svelte-bbasel"></div>'),il=E('<span class="spell-level svelte-bbasel"> </span>'),ol=E('<span class="prepared svelte-bbasel">‚úì</span>'),ll=E('<span class="prop svelte-bbasel"> </span>'),cl=E('<span class="prop svelte-bbasel"> </span>'),ul=E('<span class="prop svelte-bbasel"> </span>'),vl=E('<span class="prop svelte-bbasel"> </span>'),dl=E('<span class="prop svelte-bbasel"> </span>'),fl=E('<span class="prop svelte-bbasel"> </span>'),pl=E('<span class="prop-tags svelte-bbasel"> </span>'),ml=E('<div class="item-properties svelte-bbasel"><!> <!> <!> <!> <!> <!> <!></div>'),_l=E('<div class="item spell-item svelte-bbasel"><div class="item-main svelte-bbasel"><span class="item-name svelte-bbasel"> </span> <!> <!></div> <!></div>'),gl=E('<p class="empty svelte-bbasel">No spells</p>'),hl=E('<div class="items svelte-bbasel"></div>'),wl=E('<div class="tabs svelte-bbasel"><button> </button> <button> </button> <button> </button></div> <div class="tab-content svelte-bbasel"><!></div>',1),bl=E('<div class="equipment-manager svelte-bbasel"><!></div>');function Us(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=Be(a,"character",12,null),s=V([]),i=V([]),o=V([]),v=V(!0),l=V(null),u=V("equipment");async function g(){if(r())try{C(v,!0);const f=encodeURIComponent(r()),T=await fetch(`/dnd-api/dnd/equipment/${f}?campaign=${n()}`);if(!T.ok)throw new Error("Failed to load character data");const I=await T.json();C(s,I.equipment||[]),C(i,I.inventory||[]),C(o,I.spells||[]),C(l,null)}catch(f){C(l,f.message),console.error("Error loading data:",f)}finally{C(v,!1)}}async function q(f){try{(await fetch(`/dnd-api/dnd/equipment/${f}?campaign=${n()}`,{method:"DELETE"})).ok&&await g()}catch(T){console.error("Error removing equipment:",T)}}function y(f){r(f.detail.character),g()}gt(()=>{window.addEventListener("characterSelected",y)}),Fs(()=>{window.removeEventListener("characterSelected",y)}),tt(()=>Ae(r()),()=>{r()&&g()}),gr(),ct();var b=bl(),p=d(b);{var h=f=>{var T=Qo();m(f,T)},S=f=>{var T=Ke(),I=Se(T);{var O=k=>{var j=Ko(),$=d(j);F(()=>A($,`Loading ${r()??""}'s items...`)),m(k,j)},P=k=>{var j=Ke(),$=Se(j);{var R=K=>{var J=zo(),ae=d(J);F(()=>A(ae,t(l))),m(K,J)},Q=K=>{var J=wl(),ae=Se(J),U=d(ae);let H;var G=d(U),Y=_(U,2);let W;var te=d(Y),Z=_(Y,2);let he;var Le=d(Z),Ue=_(ae,2),xe=d(Ue);{var Ne=ze=>{var ut=tl();Ge(ut,5,()=>t(s),_t,(it,oe)=>{var Tt=Xo(),ht=d(Tt),qt=d(ht),St=d(qt),Ve=_(qt,2),D=d(Ve),L=_(Ve,2),X=_(ht,2);{var w=me=>{var le=Jo(),ie=d(le);{var we=re=>{var _e=Vo(),be=d(_e);F(()=>A(be,`‚öîÔ∏è ${t(oe),c(()=>t(oe).properties.damage)??""} ${t(oe),c(()=>t(oe).properties.damageType||"")??""}`)),m(re,_e)};M(ie,re=>{t(oe),c(()=>t(oe).properties.damage)&&re(we)})}var x=_(ie,2);{var B=re=>{var _e=Wo(),be=d(_e);F(()=>A(be,`üõ°Ô∏è AC ${t(oe),c(()=>t(oe).properties.ac)??""}${t(oe),c(()=>t(oe).properties.acModifier!=="none"?" + "+t(oe).properties.acModifier:"")??""}`)),m(re,_e)};M(x,re=>{t(oe),c(()=>t(oe).properties.ac)&&re(B)})}var ee=_(x,2);{var N=re=>{var _e=Yo(),be=d(_e);F(()=>A(be,`üìè ${t(oe),c(()=>t(oe).properties.range)??""}`)),m(re,_e)};M(ee,re=>{t(oe),c(()=>t(oe).properties.range)&&re(N)})}var de=_(ee,2);{var Ce=re=>{var _e=Zo(),be=d(_e);F(vt=>A(be,vt),[()=>(t(oe),c(()=>t(oe).properties.properties.join(", ")))]),m(re,_e)};M(de,re=>{t(oe),c(()=>t(oe).properties.properties&&t(oe).properties.properties.length>0)&&re(Ce)})}m(me,le)};M(X,me=>{t(oe),c(()=>t(oe).properties&&Object.keys(t(oe).properties).length>0)&&me(w)})}F(()=>{A(St,(t(oe),c(()=>t(oe).item_name))),A(D,(t(oe),c(()=>t(oe).item_type)))}),fe("click",L,()=>q(t(oe).id)),m(it,Tt)},it=>{var oe=el();m(it,oe)}),m(ze,ut)},Pe=ze=>{var ut=Ke(),it=Se(ut);{var oe=ht=>{var qt=sl();Ge(qt,5,()=>t(i),_t,(St,Ve)=>{var D=nl(),L=d(D),X=d(L),w=d(X),me=_(X,2);{var le=ie=>{var we=al(),x=d(we);F(()=>A(x,`x${t(Ve),c(()=>t(Ve).quantity)??""}`)),m(ie,we)};M(me,ie=>{t(Ve),c(()=>t(Ve).quantity>1)&&ie(le)})}F(()=>A(w,(t(Ve),c(()=>t(Ve).item_name)))),m(St,D)},St=>{var Ve=rl();m(St,Ve)}),m(ht,qt)},Tt=ht=>{var qt=Ke(),St=Se(qt);{var Ve=D=>{var L=hl();Ge(L,5,()=>t(o),_t,(X,w)=>{var me=_l(),le=d(me),ie=d(le),we=d(ie),x=_(ie,2);{var B=re=>{var _e=il(),be=d(_e);F(()=>A(be,`Lvl ${t(w),c(()=>t(w).spell_level)??""}`)),m(re,_e)};M(x,re=>{t(w),c(()=>t(w).spell_level!==null)&&re(B)})}var ee=_(x,2);{var N=re=>{var _e=ol();m(re,_e)};M(ee,re=>{t(w),c(()=>t(w).prepared)&&re(N)})}var de=_(le,2);{var Ce=re=>{var _e=ml(),be=d(_e);{var vt=se=>{var ye=ll(),ke=d(ye);F(()=>A(ke,`üí• ${t(w),c(()=>t(w).properties.damage)??""} ${t(w),c(()=>t(w).properties.damageType||"")??""}`)),m(se,ye)};M(be,se=>{t(w),c(()=>t(w).properties.damage)&&se(vt)})}var dt=_(be,2);{var It=se=>{var ye=cl(),ke=d(ye);F(()=>A(ke,`üíö ${t(w),c(()=>t(w).properties.healing)??""}`)),m(se,ye)};M(dt,se=>{t(w),c(()=>t(w).properties.healing)&&se(It)})}var Rt=_(dt,2);{var Ee=se=>{var ye=ul(),ke=d(ye);F(()=>A(ke,`‚ú® ${t(w),c(()=>t(w).properties.effect)??""}`)),m(se,ye)};M(Rt,se=>{t(w),c(()=>t(w).properties.effect)&&se(Ee)})}var ue=_(Rt,2);{var z=se=>{var ye=vl(),ke=d(ye);F(()=>A(ke,`üìè ${t(w),c(()=>t(w).properties.range)??""}`)),m(se,ye)};M(ue,se=>{t(w),c(()=>t(w).properties.range)&&se(z)})}var We=_(ue,2);{var wt=se=>{var ye=dl(),ke=d(ye);F(()=>A(ke,`üé≤ DC ${t(w),c(()=>t(w).properties.savingThrow)??""}`)),m(se,ye)};M(We,se=>{t(w),c(()=>t(w).properties.savingThrow)&&se(wt)})}var Dt=_(We,2);{var Gt=se=>{var ye=fl(),ke=d(ye);F(()=>A(ke,`‚è±Ô∏è ${t(w),c(()=>t(w).properties.duration)??""}`)),m(se,ye)};M(Dt,se=>{t(w),c(()=>t(w).properties.duration)&&se(Gt)})}var Qe=_(Dt,2);{var $e=se=>{var ye=pl(),ke=d(ye);F(()=>A(ke,(t(w),c(()=>t(w).properties.school)))),m(se,ye)};M(Qe,se=>{t(w),c(()=>t(w).properties.school)&&se($e)})}m(re,_e)};M(de,re=>{t(w),c(()=>t(w).properties&&Object.keys(t(w).properties).length>0)&&re(Ce)})}F(()=>A(we,(t(w),c(()=>t(w).spell_name)))),m(X,me)},X=>{var w=gl();m(X,w)}),m(D,L)};M(St,D=>{t(u)==="spells"&&D(Ve)},!0)}m(ht,qt)};M(it,ht=>{t(u)==="inventory"?ht(oe):ht(Tt,!1)},!0)}m(ze,ut)};M(xe,ze=>{t(u)==="equipment"?ze(Ne):ze(Pe,!1)})}F((ze,ut,it)=>{H=ge(U,1,"tab svelte-bbasel",null,H,ze),A(G,`‚öîÔ∏è Equipment (${t(s),c(()=>t(s).length)??""})`),W=ge(Y,1,"tab svelte-bbasel",null,W,ut),A(te,`üéí Inventory (${t(i),c(()=>t(i).length)??""})`),he=ge(Z,1,"tab svelte-bbasel",null,he,it),A(Le,`‚ú® Spells (${t(o),c(()=>t(o).length)??""})`)},[()=>({active:t(u)==="equipment"}),()=>({active:t(u)==="inventory"}),()=>({active:t(u)==="spells"})]),fe("click",U,()=>C(u,"equipment")),fe("click",Y,()=>C(u,"inventory")),fe("click",Z,()=>C(u,"spells")),m(K,J)};M($,K=>{t(l)?K(R):K(Q,!1)},!0)}m(k,j)};M(I,k=>{t(v)?k(O):k(P,!1)},!0)}m(f,T)};M(p,f=>{r()?f(S,!1):f(h)})}m(e,b),st()}var yl=E('<div class="empty-rolls svelte-10jtuh">No recent rolls</div>'),xl=E('<span class="roll-dc svelte-10jtuh"> </span>'),El=E('<span class="roll-breakdown svelte-10jtuh"> </span>'),kl=E('<div><div class="roll-header svelte-10jtuh"><span class="roll-character svelte-10jtuh"> </span> <span class="roll-time svelte-10jtuh"> </span></div> <div class="roll-details svelte-10jtuh"><span class="roll-skill svelte-10jtuh"> </span> <!></div> <div class="roll-result svelte-10jtuh"><span class="roll-total svelte-10jtuh"> </span> <!></div></div>'),ql=E('<div class="rolls-list svelte-10jtuh"></div>'),Sl=E('<div class="recent-rolls svelte-10jtuh"><h5 class="svelte-10jtuh">Recent Rolls</h5> <!> <button class="btn-clear svelte-10jtuh">Clear History</button></div>');function $l(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V([]);gt(()=>(s(),window.addEventListener("rollMade",i),()=>{window.removeEventListener("rollMade",i)}));function s(){const p=localStorage.getItem(`${n()}_recentRolls`);if(p)try{C(r,JSON.parse(p))}catch(h){console.error("Error loading rolls:",h),C(r,[])}}function i(p){const h=p.detail;C(r,[h,...t(r)].slice(0,10)),localStorage.setItem(`${n()}_recentRolls`,JSON.stringify(t(r)))}function o(){C(r,[]),localStorage.removeItem(`${n()}_recentRolls`)}function v(p){return p.dc?p.total>=p.dc?"success":"failure":""}function l(p){if(!p)return"";const h=new Date(p),f=new Date-h;return f<6e4?"Just now":f<36e5?`${Math.floor(f/6e4)}m ago`:f<864e5?`${Math.floor(f/36e5)}h ago`:h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}ct();var u=Sl(),g=_(d(u),2);{var q=p=>{var h=yl();m(p,h)},y=p=>{var h=ql();Ge(h,5,()=>t(r),_t,(S,f)=>{var T=kl(),I=d(T),O=d(I),P=d(O),k=_(O,2),j=d(k),$=_(I,2),R=d($),Q=d(R),K=_(R,2);{var J=W=>{var te=xl(),Z=d(te);F(()=>A(Z,`DC ${t(f),c(()=>t(f).dc)??""}`)),m(W,te)};M(K,W=>{t(f),c(()=>t(f).dc)&&W(J)})}var ae=_($,2),U=d(ae),H=d(U),G=_(U,2);{var Y=W=>{var te=El(),Z=d(te);F(()=>A(Z,`(${t(f),c(()=>t(f).dice||"d20")??""}: ${t(f),c(()=>t(f).diceRoll)??""}${t(f),c(()=>t(f).modifier>=0?"+":"")??""}${t(f),c(()=>t(f).modifier)??""})`)),m(W,te)};M(G,W=>{t(f),c(()=>t(f).modifier)&&W(Y)})}F((W,te)=>{ge(T,1,`roll-item ${W??""}`,"svelte-10jtuh"),A(P,(t(f),c(()=>t(f).character||"Unknown"))),A(j,te),A(Q,(t(f),c(()=>t(f).skill||"Roll"))),A(H,(t(f),c(()=>t(f).total)))},[()=>(t(f),c(()=>v(t(f)))),()=>(t(f),c(()=>l(t(f).timestamp)))]),m(S,T)}),m(p,h)};M(g,p=>{t(r),c(()=>t(r).length===0)?p(q):p(y,!1)})}var b=_(g,2);fe("click",b,o),m(e,u),st()}var Al=E('<div class="campaign-notes svelte-1u6equv"><div class="notes-header svelte-1u6equv"><h5 class="svelte-1u6equv">Campaign Notes</h5> <span><!></span></div> <textarea placeholder="Keep track of important details, NPCs, locations, theories..." class="svelte-1u6equv"></textarea></div>');function Cl(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V(""),s=null,i=V(null),o=V(!1);gt(()=>{v()});function v(){const O=localStorage.getItem(`${n()}_notes`);O&&C(r,O)}function l(){C(o,!0),s&&clearTimeout(s),s=setTimeout(()=>{u()},500)}function u(){localStorage.setItem(`${n()}_notes`,t(r)),C(i,new Date),C(o,!1)}function g(){if(!t(i))return"";const P=new Date-t(i);return P<3e3?"Saved just now":P<6e4?`Saved ${Math.floor(P/1e3)}s ago`:P<36e5?`Saved ${Math.floor(P/6e4)}m ago`:`Saved at ${t(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}let q;gt(()=>(q=setInterval(()=>{t(i)&&C(i,t(i))},5e3),()=>{clearInterval(q),s&&clearTimeout(s)})),ct();var y=Al(),b=d(y),p=_(d(b),2);let h;var S=d(p);{var f=O=>{var P=Fe("Saving...");m(O,P)},T=O=>{var P=Ke(),k=Se(P);{var j=$=>{var R=Fe();F(Q=>A(R,Q),[()=>c(g)]),m($,R)};M(k,$=>{t(i)&&$(j)},!0)}m(O,P)};M(S,O=>{t(o)?O(f):O(T,!1)})}var I=_(b,2);F(O=>h=ge(p,1,"save-status svelte-1u6equv",null,h,O),[()=>({saving:t(o)})]),Ls(I,()=>t(r),O=>C(r,O)),fe("input",I,l),m(e,y),st()}const Tl=e=>e;function Hs(e){const a=e-1;return a*a*a+1}function Fr(e){const a=typeof e=="string"&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return a?[parseFloat(a[1]),a[2]||"px"]:[e,"px"]}function at(e,{delay:a=0,duration:n=400,easing:r=Tl}={}){const s=+getComputedStyle(e).opacity;return{delay:a,duration:n,easing:r,css:i=>`opacity: ${i*s}`}}function Ta(e,{delay:a=0,duration:n=400,easing:r=Hs,x:s=0,y:i=0,opacity:o=0}={}){const v=getComputedStyle(e),l=+v.opacity,u=v.transform==="none"?"":v.transform,g=l*(1-o),[q,y]=Fr(s),[b,p]=Fr(i);return{delay:a,duration:n,easing:r,css:(h,S)=>`
			transform: ${u} translate(${(1-h)*q}${y}, ${(1-h)*b}${p});
			opacity: ${l-g*S}`}}function pn(e,{delay:a=0,duration:n=400,easing:r=Hs,start:s=0,opacity:i=0}={}){const o=getComputedStyle(e),v=+o.opacity,l=o.transform==="none"?"":o.transform,u=1-s,g=v*(1-i);return{delay:a,duration:n,easing:r,css:(q,y)=>`
			transform: ${l} scale(${1-u*y});
			opacity: ${v-g*y}
		`}}function Ur(e){return--e*e*((1.70158+1)*e+1.70158)+1}function Il(e){return Math.sin(-13*(e+1)*Math.PI/2)*Math.pow(2,-10*e)+1}function Ia(e){return--e*e*e*e*e+1}var Rl=E('<span class="cursor svelte-4cpm4c">‚ñä</span>'),Dl=E('<div class="typewriter svelte-4cpm4c" role="button" tabindex="0"><!> <!></div>');function Ml(e,a){rt(a,!1);const n=To();let r=Be(a,"text",8,""),s=Be(a,"speed",8,10),i=V(""),o=0,v=V(!1);gt(()=>{if(!r()){C(v,!0),n("complete");return}const h=setInterval(()=>{o<r().length?(C(i,r().substring(0,o+1)),o++):(C(v,!0),clearInterval(h),n("complete"))},s());return()=>clearInterval(h)});function l(){C(i,r()),o=r().length,C(v,!0),n("complete")}function u(h){(h.key==="Enter"||h.key===" "||h.key==="Spacebar")&&l()}ct();var g=Dl(),q=d(g);{var y=h=>{var S=Ke(),f=Se(S);Ms(f,()=>t(i)),m(h,S)};M(q,h=>{t(i)&&h(y)})}var b=_(q,2);{var p=h=>{var S=Rl();m(h,S)};M(b,h=>{t(v)||h(p)})}fe("click",g,l),fe("keydown",g,u),m(e,g),st()}var Pl=E('<div><div class="entry-header"><span> </span> <span class="entry-time"> </span></div> <div class="entry-content"><!></div></div>'),jl=E('<div class="roll-prompt svelte-sd7dgk"><div class="roll-prompt-header svelte-sd7dgk">üé≤ <strong> </strong></div> <div class="roll-prompt-description svelte-sd7dgk"><!></div> <div class="roll-prompt-buttons svelte-sd7dgk"><button class="btn-dice svelte-sd7dgk">üé≤ Roll d20</button></div></div>'),Ll=E("<!> <!>",1);function Nl(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V([]),s=V(-1),i=V(null),o=null;gt(()=>(window.addEventListener("newGameMessage",l),window.addEventListener("removeThinkingMessage",u),window.addEventListener("showRollPrompt",g),v(),()=>{window.removeEventListener("newGameMessage",l),window.removeEventListener("removeThinkingMessage",u),window.removeEventListener("showRollPrompt",g)}));async function v(){try{const P=`/dnd/campaigns/${n()}/conversation-history.json`,k=await fetch(P);if(k.ok){const j=await k.json();C(r,j.map(($,R)=>({id:Date.now()+R,role:$.role==="player"?"user":"assistant",content:$.content,mode:$.mode||"ic",timestamp:$.timestamp||new Date().toISOString(),isTyping:!1}))),console.log(`üìù Loaded ${t(r).length} messages from conversation history`),await Tn(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{b(),console.log("üìú Scrolled to bottom after initial load"),setTimeout(b,500)})})}}catch{console.log("No existing conversation history found, starting fresh"),C(r,[{id:Date.now(),role:"assistant",content:"<p>Welcome, brave adventurer! Your story begins here...</p>",mode:"ic",timestamp:new Date().toISOString(),isTyping:!1}])}}async function l(P){const{role:k,content:j,mode:$,timestamp:R,isThinking:Q}=P.detail,K={id:Date.now(),role:k,content:j,mode:$||"ic",timestamp:R||new Date().toISOString(),isTyping:k==="assistant",isThinking:Q||!1};C(r,[...t(r),K]),K.isTyping&&(C(s,t(r).length-1),await Tn(),b())}function u(){C(r,t(r).filter(P=>!P.isThinking))}function g(P){const{rollDetails:k,rollRequest:j}=P.detail;console.log("üì• Roll prompt event received:",k);let $=k.description;if(k.skill==="Initiative"){const R=/,?\s*(?:and\s+)?(?:the\s+)?(?:Cult(?:ist)?\s+(?:Fanatic|Mage)|Bandit|Goblin|Orc|Skeleton|Zombie|Wolf|Bear|Dragon|Giant|Troll)[^,]*/gi;$=$.replace(R,""),$=$.replace(/^for\s+/,"").replace(/,\s*$/,"").replace(/,\s*and\s*$/,"").trim(),$&&($=`for ${$}`)}o={skill:k.skill,dc:k.dc,description:$,request:j}}function q(){o&&(C(i,o),o=null,b())}async function y(){if(!t(i)||!window.game)return;const P=t(i);if(C(i,null),P.skill==="Initiative"){console.log("üîç DEBUG: Full currentPrompt:",P),console.log("üîç DEBUG: Description:",P.description);const k=P.description.match(/for (.+)(?:[.!?]|$)/);if(console.log("üîç DEBUG: participantsMatch:",k),k){const j=k[1].trim();console.log("üîç DEBUG: participantText:",j);const $=j.split(/,\s*(?:and\s+)?/).map(U=>U.trim());console.log("üîç DEBUG: allParticipants after split:",$);const R=["Kira","Thorne","Riven"],Q=$.filter(U=>R.some(H=>U.toLowerCase().includes(H.toLowerCase())));console.log("üé≤ Rolling Initiative for party members:",Q),console.log(`üîç DEBUG: partyRolls length: ${Q.length}`);const K=[];for(const U of Q){const H=window.game.calculateDiceRoll("d20"),G=window.game.getSkillModifier(`Roll Initiative for ${U}`),Y=H.total+G;K.push({name:U,roll:H.total,modifier:G,total:Y})}const ae=`üé≤ **Initiative Rolls:**
${K.map(U=>`**${U.name}**: ${U.total} (rolled ${U.roll}${U.modifier!==0?` + ${U.modifier}`:""})`).join(`
`)}

(DM: Please roll initiative for enemies and establish turn order)`;if(window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"user",content:ae,mode:"ic",timestamp:new Date().toISOString()}})),K.forEach(U=>{window.game.addToRollHistory({skill:"Initiative",roll:U.roll,total:U.total,modifier:U.modifier,timestamp:new Date})}),window.claudeAPI){await Tn(),await new Promise(H=>setTimeout(H,100)),window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:'<p class="dm-thinking">ü§î DM is thinking...</p>',mode:"ic",timestamp:new Date().toISOString(),isThinking:!0}}));const U=await window.claudeAPI.sendMessage(ae,"ic",!1);if(console.log("üì• Initiative response received:",{hasCombatDetected:!!U?.combatDetected,hasEnemies:!!U?.enemies,enemiesLength:U?.enemies?.length,fullResponse:U}),window.dispatchEvent(new CustomEvent("removeThinkingMessage")),U&&U.narrative&&window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:U.narrative,mode:"ic",timestamp:new Date().toISOString()}})),U&&U.handoffData&&window.dispatchEvent(new CustomEvent("combatHandoffReady",{detail:U.handoffData})),U&&(U.combatDetected||U.enemies||U.handoffData)){const H=U.handoffData||null,G=H?.participants?.enemies||U.enemies||[],Y=H?.initiativeOrder||U.initiativeOrder||[],W={},te=Array.isArray(Y)&&Y.some(Z=>Number.isFinite(Number(Z?.initiative)));Y.filter(Z=>Z?.isPlayer).forEach(Z=>{Z?.id?W[Z.id]=Z.initiative??null:Z?.name&&(W[Z.name]=Z.initiative??null)}),console.log("‚öîÔ∏è Combat detected! Entering combat mode...",G),te?window.game&&window.game.enterCombatMode?(H?window.game.enterCombatMode(H,{playerInitiatives:W,context:H.context||{}}):window.game.enterCombatMode(G||[],{playerInitiatives:W}),console.log("‚úÖ Combat mode activated with",G.length,"enemies in initiative order.")):console.error("‚ùå window.game.enterCombatMode not available!"):console.log("‚ö†Ô∏è Combat handoff missing initiative results; deferring combat activation until rolls are ready.")}else console.log("‚ÑπÔ∏è No combat detected in response")}}}else await window.game.rollForRequest("d20",P.request)}function b(){const P=document.querySelector(".game-log");P?(P.scrollTop=P.scrollHeight,console.log(`üìú Scrolled game-log to ${P.scrollHeight}px`)):console.warn("‚ö†Ô∏è .game-log container not found!")}function p(P){return P==="assistant"?"üé≠ Dungeon Master":P==="user"?"‚öîÔ∏è You":P}function h(P){if(!P)return"Just now";const k=new Date(P),$=new Date-k;return $<6e4?"Just now":$<36e5?`${Math.floor($/6e4)}m ago`:k.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function S(P){const k=/üé≤ Roll [^üé≤]+/g,j=P.match(k)||[];let $=P;j.forEach((Q,K)=>{$=$.replace(Q,`DICE_ROLL_PLACEHOLDER_${K}`)});let R=$.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"</p><p>");return j.forEach((Q,K)=>{R=R.replace(`DICE_ROLL_PLACEHOLDER_${K}`,Q)}),R.startsWith("<p>")||(R="<p>"+R+"</p>"),R}ct();var f=Ll(),T=Se(f);Ge(T,3,()=>t(r),P=>P.id,(P,k,j)=>{var $=Pl();let R;var Q=d($),K=d(Q);let J;var ae=d(K),U=_(K,2),H=d(U),G=_(Q,2),Y=d(G);{var W=Z=>{{let he=Ft(()=>(t(k),c(()=>S(t(k).content))));Ml(Z,{get text(){return t(he)},$$events:{complete:q}})}},te=Z=>{var he=Ke(),Le=Se(he);Ms(Le,()=>(t(k),c(()=>S(t(k).content)))),m(Z,he)};M(Y,Z=>{t(k),Ae(t(j)),t(s),c(()=>t(k).isTyping&&t(j)===t(s))?Z(W):Z(te,!1)})}F((Z,he,Le,Ue)=>{R=ge($,1,`log-entry ${t(k),c(()=>t(k).role)??""}-entry`,"svelte-sd7dgk",R,Z),Ba($,"data-mode",(t(k),c(()=>t(k).mode))),J=ge(K,1,"entry-author",null,J,he),A(ae,Le),A(H,Ue)},[()=>({"dm-entry":t(k).role==="assistant","player-entry":t(k).role==="user"}),()=>({"dm-author":t(k).role==="assistant"}),()=>(t(k),c(()=>p(t(k).role))),()=>(t(k),c(()=>h(t(k).timestamp)))]),qe(1,$,()=>Ta,()=>({y:20,duration:400,easing:Ia})),m(P,$)});var I=_(T,2);{var O=P=>{var k=jl(),j=d(k),$=_(d(j)),R=d($),Q=_(j,2),K=d(Q);{var J=G=>{var Y=Fe();F(()=>A(Y,(t(i),c(()=>t(i).description)))),m(G,Y)},ae=G=>{var Y=Fe();F(()=>A(Y,`to ${t(i),c(()=>t(i).description)??""}`)),m(G,Y)};M(K,G=>{t(i),c(()=>t(i).skill==="Initiative")?G(J):G(ae,!1)})}var U=_(Q,2),H=d(U);F(()=>A(R,`Roll ${t(i),c(()=>t(i).skill)??""}${t(i),c(()=>t(i).dc?` (DC ${t(i).dc})`:"")??""}`)),fe("click",H,y),qe(1,k,()=>pn,()=>({duration:300,easing:Ia})),m(P,k)};M(I,P=>{t(i)&&P(O)})}m(e,f),st()}var Ol=E('<button><span class="mode-icon svelte-kfjoc2"> </span> <span class="mode-label svelte-kfjoc2"> </span></button>'),Fl=E('<span class="spinner svelte-kfjoc2">‚ü≥</span>'),Ul=E('<span class="send-icon svelte-kfjoc2">‚û§</span>'),Hl=E(`<div class="game-input svelte-kfjoc2"><div class="input-area svelte-kfjoc2"><textarea placeholder="Describe your action... (e.g., 'I cautiously step into the forest, sword drawn')" rows="3"></textarea> <div class="input-controls svelte-kfjoc2"><div class="mode-selector svelte-kfjoc2"></div> <button><!> <span>Send Action</span></button></div></div></div>`);function Gl(e,a){rt(a,!1);const n="test-silverpeak";let r=V(""),s=V("ic"),i=V(!1);const o=[{id:"ic",icon:"‚öîÔ∏è",label:"In-Character",color:"#2ecc71"},{id:"dm-question",icon:"‚ùì",label:"DM Question",color:"#3498db"},{id:"ooc",icon:"üîß",label:"OOC",color:"#7a8a8f"}];function v(k){C(s,k)}async function l(){!t(r).trim()||t(i)||(C(i,!0),window.dispatchEvent(new CustomEvent("playerAction",{detail:{message:t(r),mode:t(s)}})),setTimeout(()=>{C(r,""),C(i,!1)},300))}function u(k){k.key==="Enter"&&(k.ctrlKey||k.metaKey)&&l()}var g={campaign:n};ct();var q=Hl(),y=d(q),b=d(y);let p;var h=_(b,2),S=d(h);Ge(S,5,()=>o,_t,(k,j)=>{var $=Ol();let R;var Q=d($),K=d(Q),J=_(Q,2),ae=d(J);F(U=>{R=ge($,1,"mode-btn svelte-kfjoc2",null,R,U),Ps($,`--mode-color: ${t(j).color??""}`),A(K,t(j).icon),A(ae,t(j).label)},[()=>({active:t(s)===t(j).id})]),fe("click",$,()=>v(t(j).id)),qe(1,$,()=>pn,()=>({duration:200,easing:Ia})),m(k,$)});var f=_(S,2);let T;var I=d(f);{var O=k=>{var j=Fl();m(k,j)},P=k=>{var j=Ul();m(k,j)};M(I,k=>{t(i)?k(O):k(P,!1)})}return F((k,j,$)=>{p=ge(b,1,"svelte-kfjoc2",null,p,k),T=ge(f,1,"send-btn svelte-kfjoc2",null,T,j),f.disabled=$},[()=>({sending:t(i)}),()=>({sending:t(i)}),()=>!t(r).trim()||t(i)]),Ls(b,()=>t(r),k=>C(r,k)),fe("keydown",b,u),fe("click",f,l),m(e,q),qo(a,"campaign",n),st(g)}var Bl=E('<div class="skill-name svelte-11tx26q"> </div>'),Ql=E('<div class="dc-display svelte-11tx26q"> </div>'),Kl=E('<div class="description svelte-11tx26q"> </div>'),zl=E('<div class="modifier svelte-11tx26q"> </div>'),Vl=E('<span class="result-text svelte-11tx26q"> </span>'),Wl=E('<div><span class="total-label svelte-11tx26q">Total:</span> <span class="total-value svelte-11tx26q"> </span> <!></div>'),Yl=E('<div><div class="d20-face svelte-11tx26q"> </div> <!></div> <!>',1),Zl=E('<button class="roll-button svelte-11tx26q"><span class="button-icon svelte-11tx26q">üé≤</span> <span class="svelte-11tx26q">Roll the Dice!</span></button>'),Jl=E('<div class="dice-prompt-overlay svelte-11tx26q"><div class="dice-prompt svelte-11tx26q"><div class="prompt-header svelte-11tx26q"><span class="dice-icon svelte-11tx26q">üé≤</span> <h3 class="svelte-11tx26q">Roll Required!</h3></div> <div class="roll-info svelte-11tx26q"><!> <!> <!></div> <div><!></div> <!></div></div>');function Xl(e,a){rt(a,!1);let n=Be(a,"rollDetails",24,()=>({})),r=Be(a,"onRoll",8,()=>{}),s=V(!1),i=V(null),o=V(!1);function v(){if(t(s))return;C(s,!0);const R=1e3,Q=50,K=R/Q;let J=0;const ae=setInterval(()=>{if(C(i,Math.floor(Math.random()*20)+1),J++,J>=K){clearInterval(ae);const U=Math.floor(Math.random()*20)+1;C(i,U),C(o,!0),setTimeout(()=>{r()(U)},1500)}},Q)}function l(){return!n().dc||!t(i)?"":t(i)+(n().modifier||0)>=n().dc?"success":"failure"}function u(){return t(i)+(n().modifier||0)}ct();var g=Jl(),q=d(g),y=_(d(q),2),b=d(y);{var p=R=>{var Q=Bl(),K=d(Q);F(()=>A(K,(Ae(n()),c(()=>n().skill)))),m(R,Q)};M(b,R=>{Ae(n()),c(()=>n().skill)&&R(p)})}var h=_(b,2);{var S=R=>{var Q=Ql(),K=d(Q);F(()=>A(K,`DC ${Ae(n()),c(()=>n().dc)??""}`)),m(R,Q)};M(h,R=>{Ae(n()),c(()=>n().dc)&&R(S)})}var f=_(h,2);{var T=R=>{var Q=Kl(),K=d(Q);F(()=>A(K,(Ae(n()),c(()=>n().description)))),m(R,Q)};M(f,R=>{Ae(n()),c(()=>n().description)&&R(T)})}var I=_(y,2);let O;var P=d(I);{var k=R=>{var Q=Yl(),K=Se(Q),J=d(K),ae=d(J),U=_(J,2);{var H=W=>{var te=zl(),Z=d(te);F(()=>A(Z,`${Ae(n()),c(()=>n().modifier>=0?"+":"")??""}${Ae(n()),c(()=>n().modifier)??""}`)),qe(1,te,()=>Ta,()=>({x:-20,duration:300,delay:200})),m(W,te)};M(U,W=>{t(o),Ae(n()),c(()=>t(o)&&n().modifier)&&W(H)})}var G=_(K,2);{var Y=W=>{var te=Wl(),Z=_(d(te),2),he=d(Z),Le=_(Z,2);{var Ue=xe=>{var Ne=Vl(),Pe=d(Ne);F(ze=>A(Pe,ze),[()=>(Ae(n()),c(()=>u()>=n().dc?"‚úì Success!":"‚úó Failed"))]),m(xe,Ne)};M(Le,xe=>{Ae(n()),c(()=>n().dc)&&xe(Ue)})}F((xe,Ne)=>{ge(te,1,`total-result ${xe??""}`,"svelte-11tx26q"),A(he,Ne)},[()=>c(l),()=>c(u)]),qe(1,te,()=>pn,()=>({duration:400,delay:400,easing:Ur})),m(W,te)};M(G,W=>{t(o)&&W(Y)})}F(W=>{ge(K,1,`dice-result ${W??""}`,"svelte-11tx26q"),A(ae,t(i))},[()=>c(l)]),qe(1,K,()=>pn,()=>({duration:300,easing:Il})),m(R,Q)};M(P,R=>{t(i)!==null&&R(k)})}var j=_(I,2);{var $=R=>{var Q=Zl();fe("click",Q,v),m(R,Q)};M(j,R=>{t(s)||R($)})}F(R=>O=ge(I,1,"dice-display svelte-11tx26q",null,O,R),[()=>({rolling:t(s),"result-shown":t(o)})]),qe(1,q,()=>pn,()=>({duration:400,easing:Ur})),qe(1,g,()=>Ta,()=>({y:-50,duration:400})),m(e,g),st()}const jn=nn([]),rn=nn([]),Za=nn({}),Qn=e=>(e||"").toString().trim().toLowerCase(),ec=new Set(["rolled","auto","override","complete"]);function tc(e){return Qn(e)}function Ln(e,a){return`${e}:${Qn(a?.participantId||a?.id||a?.name)}`}function Kn(e){return e?.metadata?.combatAction||null}function ac(e){const a=Kn(e);if(!a||!Array.isArray(a.steps))return null;const n=Number.isInteger(a.currentStepIndex)?a.currentStepIndex:0;return a.steps[n]||null}function kr(e){const a=Kn(e);if(!a||a.kind!=="attack")return null;const n=Array.isArray(a.steps)?a.steps:[],r=n.find(u=>u.type==="attack"),s=n.find(u=>u.type==="damage"),i=a.attacker?.name||e.participants?.find?.(u=>u.entityType==="player")?.name||e.participants?.[0]?.name||"Attacker",o=a.attackName||"attack",v=[],l=a.outcome||null;if(r?.result||l){const u=r?.result||{},g=Number.isFinite(l?.total)?l.total:u.total,q=Number.isFinite(l?.natural)?l.natural:u.natural,y=Number.isFinite(l?.modifier)?l.modifier:u.modifier,b=Number.isFinite(l?.targetAC)?l.targetAC:a.targetAC;let p=`${i} ${o} attack`;if(Number.isFinite(g)&&(p+=` ${g}`),Number.isFinite(q)){const h=Number.isFinite(y)?y>=0?`+${y}`:`${y}`:null;p+=h?` (${q} ${h})`:` (${q})`}Number.isFinite(b)&&(p+=` vs AC ${b}`),l?.crit?p+=" ‚Äî critical hit":l?.hit===!0?p+=" ‚Äî hit":l?.hit===!1&&(p+=" ‚Äî miss"),v.push(p)}if(s?.result){const u=s.formula||s.result.formula||a.damage?.formula||null,g=s.damageType||a.damage?.type||null,q=s.result.total;let y="Damage";u&&(y+=` ${u}`),Number.isFinite(q)&&(y+=` = ${q}`),g&&(y+=` ${g}`),v.push(y)}return v.length?{summary:`${i}: ${o}`,text:v.join(`
`)}:null}function gn(e,a){const n=Kn(e);let r=e.reason||a.notes||"Roll";if(n?.kind==="attack"){const u=ac(e);if(n.awaitingDamage||u&&u.type==="damage")r=`Damage: ${n.attackName||"Attack"}`;else{const q=Number.isFinite(n.targetAC)?` vs AC ${n.targetAC}`:"";r=`${n.attackName||"Attack"} attack${q}`}const g=kr(e);g&&!(n.awaitingDamage||u&&u.type==="damage")&&(r=g.summary)}else if(n?.kind==="saving-throw"){const u=n.ability?n.ability.toUpperCase():"Save",g=Number.isFinite(n.dc)?` (DC ${n.dc})`:"";r=`${u} saving throw${g}`}const s=a.ability||e.ability||null,i=a.dc||e.dc?` (DC ${a.dc??e.dc})`:"",o=s?` [${s.toUpperCase()}]`:"",l=(a.entityType||"").toLowerCase()==="enemy"?"[DM-controlled]":a.entityType==="player"?"[Player]":"";return`${l?`${l} `:""}${r}${o}${i}`.trim()}function Gs(e,a){const n=kr(e);if(n)return n.text;const r=gn(e,a),s=a.result?.total??"‚Äî",i=a.result?.natural,o=a.result?.modifier,v=typeof o=="number"&&o!==0?` (${i??"?"} ${o>=0?"+":""}${o})`:i!==void 0?` (${i})`:"",l=a.status==="override"?"OVERRIDDEN":`Result ${s}`,u=Kn(e);return`${u?.attacker?.name?u.attacker.name:a.name} ${r}: ${l}${v}`}function Hr(e=[]){const a=Array.isArray(e)?e:[];jn.set(a);const n=new Set;a.forEach(r=>{(r.participants||[]).forEach(s=>{n.add(Ln(r.queueId,s))})}),Za.update(r=>{const s={};for(const i of Object.keys(r||{}))n.has(i)&&(s[i]=r[i]);return s}),rn.update(r=>r.filter(s=>n.has(Ln(s.queueId,{participantId:s.participantId,name:s.participantName}))))}function Bs(e,a){if(!e||!a)return{staged:!1,reason:"Invalid roll entry"};const n=Ln(e.queueId,a);if(xr(Za)[n])return{staged:!1,reason:"Already staged"};if(!a.result)return{staged:!1,reason:"Result not available yet"};const s=kr(e),i=s?s.summary:gn(e,a),o=s?s.text:Gs(e,a);return Za.update(v=>({...v,[n]:!0})),rn.update(v=>[...v,{queueId:e.queueId,participantId:a.participantId||a.id||Qn(a.name),participantName:a.name,summary:i,text:o}]),{staged:!0}}function nc(){rn.set([]),Za.set({})}function Gr(){return xr(rn)}function rc(e){return!e||e.length===0?"":`**Queued Roll Results**
${e.map(n=>`- ${n.text}`).join(`
`)}`}const Qs=fn([jn,Za],([e,a])=>{const n={},r=(s,i)=>{const o=Qn(s.participantId||s.id||s.name);return o?(n[o]||(n[o]={name:s.name||s.id,participantId:s.participantId||s.id||null,pending:[],ready:[],stagedCount:0}),n[o]):null};return(e||[]).forEach(s=>{(s.participants||[]).forEach(i=>{const o=(i.entityType||"").toLowerCase();if(i.isPlayer===!1||o&&o!=="player")return;const v=r(i);if(!v)return;const l=(i.status||"").toLowerCase(),u={queueId:s.queueId,reason:s.reason,entry:s,participant:i,status:l};if(l==="pending")v.pending.push(u);else if(ec.has(l)){const g=Ln(s.queueId,i),q=!!a[g];q&&(v.stagedCount+=1),v.ready.push({...u,staged:q,summary:gn(s,i),text:Gs(s,i)})}})}),n}),sc=fn(Qs,e=>{const a=[];return Object.values(e||{}).forEach(n=>{n.pending.slice(0,3).forEach(r=>{a.push({type:"pending",label:`${n.name}: ${gn(r.entry,r.participant)}`,queueId:r.queueId})}),n.ready.filter(r=>!r.staged).slice(0,3).forEach(r=>{a.push({type:"ready",label:`${n.name}: ${gn(r.entry,r.participant)}`,queueId:r.queueId,participant:r.participant,entry:r.entry})})}),a});function Br(e){window.dispatchEvent(new CustomEvent("rollQueueFocus",{detail:{queueId:e}}))}function Qr(e){return e?Bs(e.entry,e.participant):{staged:!1,reason:"No roll detail provided"}}function ic(e){const a=encodeURIComponent(e),n=typeof window<"u"?window.__CLAUDE_API_CONFIG__||window.claudeAPI&&window.claudeAPI.config||{}:{},r=Array.isArray(n.combat_state_endpoints)?n.combat_state_endpoints:[],s=l=>{if(!l||typeof l!="string")return null;const u=l.trim();if(!u)return null;const g=u.includes("?")?"&":"?";return`${u}${g}campaign=${a}`},i=r.map(s).filter(Boolean),o=["/dnd-api/dnd/combat-state","/dnd/api/dnd/combat-state","/api/dnd/combat-state","/dnd-api/dnd/combat/state","/dnd/api/dnd/combat/state","/api/dnd/combat/state"].map(s).filter(Boolean),v=[];for(const l of[...i,...o])l&&!v.includes(l)&&v.push(l);return v}const Nn={active:!1,round:0,currentTurn:0,initiativeOrder:[],actionEconomy:{},conditions:{},conversationHistory:[],context:{},participants:{players:[],enemies:[]}};function Kr(e){if(!e||typeof e!="object")return{...Nn};const a=e.actionEconomy&&typeof e.actionEconomy=="object"?e.actionEconomy:{},n=e.conditions&&typeof e.conditions=="object"?e.conditions:{},s=(Array.isArray(e.initiativeOrder)?e.initiativeOrder:[]).map(o=>{const v=o?.name||"",l=a[v],u=Array.isArray(o?.conditions)?o.conditions:Array.isArray(n[v])?n[v]:[];return{...o,actionEconomy:l?{...l}:o.actionEconomy||null,conditions:u}}),i={players:Array.isArray(e.participants?.players)?e.participants.players:[],enemies:Array.isArray(e.participants?.enemies)?e.participants.enemies:[]};return i.players.length===0&&i.enemies.length===0&&s.length>0&&(i.players=s.filter(o=>o?.isPlayer),i.enemies=s.filter(o=>o&&o.isPlayer===!1)),{active:!!e.active,round:Number.isFinite(e.round)?e.round:0,currentTurn:Number.isFinite(e.currentTurn)?e.currentTurn:0,initiativeOrder:s,actionEconomy:a,conditions:n,conversationHistory:Array.isArray(e.conversationHistory)?e.conversationHistory:[],context:e.context||{},participants:i}}function oc(){const e={state:{...Nn},loading:!1,error:null,lastUpdated:null},{subscribe:a,update:n,set:r}=nn(e);let s=null,i=null,o=2e3,v=!1,l=!1,u=0;async function g(S=!1){if(!s||v)return null;v=!0,S&&n(f=>({...f,loading:!0}));try{const f=ic(s);let T,I;for(const k of f)try{if(T=await fetch(k),T.ok)break;I=new Error(`Failed to fetch combat state (${T.status})`)}catch(j){I=j}if(!T||!T.ok)throw I||new Error("Failed to fetch combat state");const O=await T.json();if(!O.success)throw new Error(O.error||"Combat state unavailable");const P=Kr(O.combatState);return r({state:P,loading:!1,error:null,lastUpdated:Date.now()}),P}catch(f){typeof f?.message=="string"&&f.message.includes("404")&&(l=!0,y());const I=Date.now();return(!l||I-u>3e4)&&(console.error("combatStore fetch failed:",f),u=I),n(O=>({...O,loading:!1,error:f.message||"Unknown error fetching combat state"})),null}finally{v=!1}}function q(S={}){const{campaign:f,interval:T}=S;f?s=f:s||(s="test-silverpeak"),l=!1,typeof T=="number"&&T>0&&(o=T),s&&(y(),g(!0),i=setInterval(g,o))}function y(){i&&(clearInterval(i),i=null)}function b(){return g(!0)}function p(S){const f=Kr(S);r({state:f,loading:!1,error:null,lastUpdated:Date.now()})}function h(S,f={}){const{fetch:T=!0}=f;!S||S===s||(s=S,T&&g(!0))}return{subscribe:a,start:q,stop:y,refresh:b,setState:p,setCampaign:h}}const Ua=oc();var lc=E('<div class="staged-indicator svelte-1md0wtl"><button type="button" class="staged-button svelte-1md0wtl"> </button> <span class="staged-subtext svelte-1md0wtl">Click to send immediately or compose a new action.</span></div>'),cc=E('<div class="game-log svelte-1md0wtl"><!> <!></div> <!> <!>',1);function uc(e,a){rt(a,!1);const n=()=>aa(rn,"$stagedResultsStore",r),[r,s]=Er();let i=Be(a,"campaign",8,"test-silverpeak"),o=V(!1),v=V({}),l=V(),u=V(!1),g=null,q;function y(H){if(!H)return H;let G=H.replace(/```json[\s\S]*?```/g,"");return G=G.replace(/```[\s\S]*?\{[\s\S]*?"combat"[\s\S]*?\}[\s\S]*?```/g,""),G=G.replace(/\n{3,}/g,`

`).trim(),G}function b(H){const G=H.detail;!G||G.role!=="assistant"||!G.content||S(G.content)}const p=H=>(H||"").toString().trim().toLowerCase();function h(H){if(!g?.initiativeOrder)return null;const G=p(H);for(let Y=0;Y<g.initiativeOrder.length;Y+=1){const W=g.initiativeOrder[Y];if(p(W?.name)===G)return{combatant:W,index:Y}}return null}function S(H){if(!g?.active||!H)return;const G=H.match(/([A-Za-z][A-Za-z0-9' \-]+),?\s*(?:you're up|you are up|is up)/i),Y=H.match(/turn\s+passes\s+to\s+([A-Za-z][A-Za-z0-9' \-]+)/i),W=G&&G[1]||Y&&Y[1];if(!W)return;const te=h(W.trim());if(!te)return;const Z={name:te.combatant.name,index:te.index,isPlayer:!!te.combatant.isPlayer},he=H.match(/([A-Za-z][A-Za-z0-9' \-]+)\s+is\s+on\s+deck/i);he&&(Z.onDeck=he[1].trim()),window.dispatchEvent(new CustomEvent("turnPrompt",{detail:Z}))}gt(()=>(window.addEventListener("requestDiceRoll",T),window.addEventListener("playerAction",O),window.addEventListener("legacyGameMessage",P),window.addEventListener("newGameMessage",b),q=Ua.subscribe(({state:H})=>{g=H}),f(),()=>{window.removeEventListener("requestDiceRoll",T),window.removeEventListener("playerAction",O),window.removeEventListener("legacyGameMessage",P),window.removeEventListener("newGameMessage",b),q?.()}));function f(){const H=setInterval(()=>{if(window.game&&window.game.addLogEntry){clearInterval(H);const G=window.game.addLogEntry;window.game.addLogEntry=function(Y,W,te){const Z=G.call(this,Y,W,te);return window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:Y==="dm"?"assistant":"user",content:W,mode:te||"ic",timestamp:new Date().toISOString()}})),Z},console.log("‚úÖ Intercepted legacy game system for Svelte integration")}},100);setTimeout(()=>clearInterval(H),5e3)}function T(H){C(v,H.detail),C(o,!0)}function I(H){if(C(o,!1),window.claudeAPI){const G={diceRoll:H,modifier:t(v).modifier||0,total:H+(t(v).modifier||0),skill:t(v).skill,dc:t(v).dc};window.dispatchEvent(new CustomEvent("diceRollComplete",{detail:G}))}}async function O(H){const G=H.detail||{},Y=G.message||"",W=G.mode||"ic",te=!!G.includeStagedOnly;if(window.claudeAPI){window.game&&(window.game.currentMode=W);try{const Z=Gr(),he=Z.length?rc(Z):"";if(te&&!he){console.warn("‚ö†Ô∏è No staged roll results available to send.");return}const Le=te?he:he?`${Y}${Y.trim().length?`

`:""}${he}`:Y,Ue=te?he:Y;if(!Ue||!Ue.trim()){console.warn("‚ö†Ô∏è No player message content to send.");return}window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"user",content:Ue,mode:W,timestamp:new Date().toISOString()}})),await new Promise(Pe=>setTimeout(Pe,50)),C(u,!0),window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:"üé≠ DM is thinking...",mode:W,timestamp:new Date().toISOString(),isThinking:!0}}));const xe=await window.claudeAPI.sendMessage(Le,W,!1);C(u,!1),window.dispatchEvent(new CustomEvent("removeThinkingMessage")),he&&!te&&window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"system",content:he,mode:W,timestamp:new Date().toISOString()}})),nc();let Ne=!1;if(xe.handoffData&&window.dispatchEvent(new CustomEvent("combatHandoffReady",{detail:xe.handoffData})),xe.type==="roll_request"){if(console.log("‚úÖ ROLL REQUEST DETECTED:",xe),xe.narrative){const Pe=y(xe.narrative);console.log("üìù Displaying cleaned narrative:",Pe.substring(0,100)+"..."),window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:Pe,mode:W,timestamp:new Date().toISOString()}}))}!xe.rollQueueEntry&&window.game&&window.game.handleRollRequest&&xe.rollRequest?(console.log("üé≤ Dispatching roll request to legacy system:",xe.rollRequest),console.log("üé≤ window.game exists:",!!window.game),console.log("üé≤ handleRollRequest exists:",!!window.game.handleRollRequest),window.game.handleRollRequest(xe.rollRequest,"")):xe.rollQueueEntry?(Ne=!0,window.game?.refreshRollQueue?.(!0),document.querySelectorAll(".roll-prompt")?.forEach(Pe=>Pe.remove())):console.warn("‚ö†Ô∏è Cannot dispatch roll request - window.game not ready")}else if(xe.narrative){const Pe=y(xe.narrative);window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:Pe,mode:W,timestamp:new Date().toISOString()}}))}xe.rollQueueEntry&&!Ne&&window.game?.refreshRollQueue?.(!0)}catch(Z){C(u,!1),window.dispatchEvent(new CustomEvent("removeThinkingMessage")),console.error("Failed to send message:",Z),window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:"The mystical forces seem to be disrupted... Please try again in a moment.",mode:W,timestamp:new Date().toISOString()}}))}}}function P(H){window.dispatchEvent(new CustomEvent("newGameMessage",{detail:H.detail}))}function k(){t(u)||!Gr().length||window.dispatchEvent(new CustomEvent("playerAction",{detail:{message:"",mode:"ic",includeStagedOnly:!0}}))}ct();var j=cc(),$=Se(j),R=d($);{var Q=H=>{var G=lc(),Y=d(G),W=d(Y);F(()=>{Y.disabled=t(u),A(W,`üì• ${n(),c(()=>n().length===1?"Roll result ready":`${n().length} roll results ready`)??""}`)}),fe("click",Y,k),m(H,G)};M(R,H=>{n(),c(()=>n().length)&&H(Q)})}var K=_(R,2);So(Nl(K,{get campaign(){return i()},$$legacy:!0}),H=>C(l,H),()=>t(l));var J=_($,2);Gl(J,{get campaign(){return i()}});var ae=_(J,2);{var U=H=>{Xl(H,{get rollDetails(){return t(v)},onRoll:I})};M(ae,H=>{t(o)&&H(U)})}m(e,j),st(),s()}var vc=E('<div class="scene-loading svelte-j406pr"><div class="spinner svelte-j406pr">üé≤</div> <p class="svelte-j406pr">Extracting scene description...</p> <p class="loading-subtext svelte-j406pr">This may take 10-30 seconds</p></div>'),dc=E('<p class="scene-desc svelte-j406pr"> </p>'),fc=E('<div class="scene-error svelte-j406pr"><span class="error-icon svelte-j406pr">‚ö†Ô∏è</span> <p class="error-message svelte-j406pr"> </p> <!></div>'),pc=E('<img alt="Generated scene" class="scene-image svelte-j406pr"/>'),mc=E('<div class="scene-placeholder svelte-j406pr"><span class="scene-icon svelte-j406pr">üé®</span> <p class="svelte-j406pr">Generate a scene image from recent adventure</p></div>'),_c=E('<div class="scene-generator svelte-j406pr"><h5 class="svelte-j406pr">Scene Visualizer</h5> <div class="scene-display svelte-j406pr"><!></div> <button class="btn-primary generate-btn svelte-j406pr"><!></button></div>');function gc(e,a){rt(a,!1);let n=Be(a,"campaign",8,"test-silverpeak"),r=V(!1),s=V(null),i=V(""),o=V(null),v=!1;gt(async()=>{await l()});async function l(){try{const I=`/dnd/campaigns/${n()}/generated-scenes/latest.png?t=${Date.now()}`;(await fetch(I,{method:"HEAD"})).ok&&(C(s,I),v=!0)}catch{console.log("No previous scene image found")}}async function u(){C(r,!0),C(o,null),C(i,"");try{console.log("üé® Requesting scene generation from server...");const O=await(await fetch("/dnd-api/dnd/generate-scene",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign:n()})})).json();O.success?(C(s,O.imageUrl),C(i,O.sceneDescription),v=!0,console.log("‚úÖ Scene generated successfully")):(C(o,O.error||"Failed to generate scene"),C(i,O.sceneDescription||""),console.error("‚ùå Scene generation failed:",O))}catch(I){C(o,"Network error while generating scene"),console.error("‚ùå Scene generation error:",I)}finally{C(r,!1)}}ct();var g=_c(),q=_(d(g),2),y=d(q);{var b=I=>{var O=vc();qe(1,O,()=>at,()=>({duration:200})),m(I,O)},p=I=>{var O=Ke(),P=Se(O);{var k=$=>{var R=fc(),Q=_(d(R),2),K=d(Q),J=_(Q,2);{var ae=U=>{var H=dc(),G=d(H);F(()=>A(G,t(i))),m(U,H)};M(J,U=>{t(i)&&U(ae)})}F(()=>A(K,t(o))),qe(1,R,()=>at,()=>({duration:200})),m($,R)},j=$=>{var R=Ke(),Q=Se(R);{var K=ae=>{var U=pc();F(()=>Ba(U,"src",t(s))),qe(1,U,()=>at,()=>({duration:400})),m(ae,U)},J=ae=>{var U=mc();qe(1,U,()=>at,()=>({duration:200})),m(ae,U)};M(Q,ae=>{t(s)?ae(K):ae(J,!1)},!0)}m($,R)};M(P,$=>{t(o)?$(k):$(j,!1)},!0)}m(I,O)};M(y,I=>{t(r)?I(b):I(p,!1)})}var h=_(q,2),S=d(h);{var f=I=>{var O=Fe("‚è≥ Generating...");m(I,O)},T=I=>{var O=Fe("üì∏ Generate Scene Image");m(I,O)};M(S,I=>{t(r)?I(f):I(T,!1)})}F(()=>h.disabled=t(r)),fe("click",h,u),m(e,g),st()}var hc=E('<div class="loading-state svelte-gxv2j2"><div class="spinner svelte-gxv2j2">üé≤</div> <p>Loading provider status...</p></div>'),wc=E('<label><input type="radio" name="ai-provider" class="svelte-gxv2j2"/> <div class="provider-card svelte-gxv2j2"><div class="provider-header svelte-gxv2j2"><strong class="svelte-gxv2j2"> </strong> <span> </span></div> <p class="provider-description svelte-gxv2j2"> </p></div></label>'),bc=E('<div class="provider-selection svelte-gxv2j2"><h4 class="svelte-gxv2j2">Select AI Provider:</h4> <!></div>'),yc=E('<div class="modal-backdrop svelte-gxv2j2" role="presentation"><div class="modal-panel svelte-gxv2j2" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-gxv2j2"><h3 class="svelte-gxv2j2">‚öôÔ∏è AI Dungeon Master Settings</h3> <button class="close-btn svelte-gxv2j2">&times;</button></div> <div class="modal-body svelte-gxv2j2"><!></div> <div class="modal-footer svelte-gxv2j2"><button class="btn-secondary svelte-gxv2j2">Cancel</button> <button class="btn-primary svelte-gxv2j2"> </button></div></div></div>');function xc(e,a){rt(a,!1);const n=[];let r=Be(a,"campaign",8,"test-silverpeak"),s=Be(a,"onClose",8,()=>{}),i=V({claude:{name:"Claude (Sonnet 4.5)",description:"Excellent narrative, character consistency, creative storytelling",available:!0},deepseek:{name:"DeepSeek (Chat)",description:"Excellent reasoning, logical problem-solving, cost-effective",available:!1},gpt4:{name:"GPT-4 (Turbo)",description:"Balanced approach, consistent responses, steady pacing",available:!1}}),o=V("claude"),v=V(!0),l=V(!1);gt(async()=>{await u()});async function u(){C(v,!0);try{const Q=await(await fetch(`/dnd-api/dnd/ai-provider?campaign=${r()}`)).json();C(o,Q.current),Q.capabilities&&Object.entries(Q.capabilities).forEach(([K,J])=>{t(i)[K]&&cn(i,t(i)[K].available=J.available)})}catch(R){console.error("Failed to load AI provider status:",R)}finally{C(v,!1)}}async function g(){C(l,!0);try{const Q=await(await fetch("/dnd-api/dnd/ai-provider",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:t(o),campaign:r()})})).json();Q.success?(window.dispatchEvent(new CustomEvent("newGameMessage",{detail:{role:"assistant",content:`üîÑ Switched AI DM to: ${Q.provider.toUpperCase()}`,mode:"ooc",timestamp:new Date().toISOString()}})),s()()):console.error("Failed to switch provider:",Q.error)}catch(R){console.error("Error switching AI provider:",R)}finally{C(l,!1)}}function q(R){R.target===R.currentTarget&&s()()}function y(R){(R.key==="Escape"||R.key==="Enter"||R.key===" ")&&s()()}ct();var b=yc();fe("keydown",Mn,y);var p=d(b),h=d(p),S=_(d(h),2),f=_(h,2),T=d(f);{var I=R=>{var Q=hc();m(R,Q)},O=R=>{var Q=bc(),K=_(d(Q),2);Ge(K,1,()=>(t(i),c(()=>Object.entries(t(i)))),_t,(J,ae)=>{var U=Gi(()=>ei(t(ae),2));let H=()=>t(U)[0],G=()=>t(U)[1];var Y=wc();let W;var te=d(Y),Z,he=_(te,2),Le=d(he),Ue=d(Le),xe=d(Ue),Ne=_(Ue,2);let Pe;var ze=d(Ne),ut=_(Le,2),it=d(ut);F((oe,Tt)=>{W=ge(Y,1,"provider-option svelte-gxv2j2",null,W,oe),te.disabled=(G(),c(()=>!G().available)),Z!==(Z=H())&&(te.value=(te.__value=H())??""),A(xe,(G(),c(()=>G().name))),Pe=ge(Ne,1,"availability svelte-gxv2j2",null,Pe,Tt),A(ze,(G(),c(()=>G().available?"‚úÖ Available":"‚ùå No API Key"))),A(it,(G(),c(()=>G().description)))},[()=>({disabled:!G().available}),()=>({available:G().available})]),Eo(n,[],te,()=>(H(),t(o)),oe=>C(o,oe)),m(J,Y)}),m(R,Q)};M(T,R=>{t(v)?R(I):R(O,!1)})}var P=_(f,2),k=d(P),j=_(k,2),$=d(j);F(()=>{k.disabled=t(l),j.disabled=t(l)||t(v),A($,t(l)?"Saving...":"Save Settings")}),fe("click",S,function(...R){s()?.apply(this,R)}),fe("click",k,function(...R){s()?.apply(this,R)}),fe("click",j,g),qe(3,p,()=>Ta,()=>({y:-50,duration:300,easing:Ia})),fe("click",p,Ns(function(R){Os.call(this,a,R)})),fe("click",b,q),qe(3,b,()=>at,()=>({duration:200})),m(e,b),st()}var Ec=E('<div class="modal-backdrop svelte-apjqso" role="presentation"><div class="modal-panel svelte-apjqso" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-header svelte-apjqso"><h2 class="svelte-apjqso">About Claude DM</h2> <button class="close-btn svelte-apjqso" aria-label="Close">&times;</button></div> <div class="modal-body svelte-apjqso"><p class="intro svelte-apjqso"><strong class="svelte-apjqso">Claude DM</strong> is an AI-powered D&D Campaign Manager that brings your adventures to life with intelligent narrative generation, real-time character management, and automated game state tracking.</p> <section class="svelte-apjqso"><h3 class="svelte-apjqso">Features</h3> <ul class="svelte-apjqso"><li class="svelte-apjqso">üé≤ Interactive dice rolling with automatic modifiers</li> <li class="svelte-apjqso">ü§ñ Multi-AI DM support (Claude, DeepSeek, GPT-4)</li> <li class="svelte-apjqso">üë• Three party members: Kira, Thorne, and Riven</li> <li class="svelte-apjqso">üìä Automatic state tracking (HP, inventory, credits)</li> <li class="svelte-apjqso">üé® AI-generated scene images</li> <li class="svelte-apjqso">üíæ Persistent campaign history with rollback support</li></ul></section> <section class="svelte-apjqso"><h3 class="svelte-apjqso">Message Modes</h3> <ul class="svelte-apjqso"><li class="svelte-apjqso"><strong class="svelte-apjqso">‚öîÔ∏è In-Character</strong> - Canon actions that advance the story and update game state</li> <li class="svelte-apjqso"><strong class="svelte-apjqso">‚ùì DM Question</strong> - Ask questions without advancing the story</li> <li class="svelte-apjqso"><strong class="svelte-apjqso">üîß OOC</strong> - Non-canon testing and experimentation</li></ul></section> <section class="svelte-apjqso"><h3 class="svelte-apjqso">Keyboard Shortcuts</h3> <ul class="svelte-apjqso"><li class="svelte-apjqso"><kbd class="svelte-apjqso">Ctrl/Cmd + Enter</kbd> - Send action</li> <li class="svelte-apjqso"><kbd class="svelte-apjqso">Esc</kbd> - Close modals</li></ul></section> <p class="footer-text svelte-apjqso">Powered by Claude Sonnet 4.5, DeepSeek, and GPT-4 APIs</p></div></div></div>');function kc(e,a){rt(a,!1);let n=Be(a,"onClose",8,()=>{});function r(u){u.target===u.currentTarget&&n()()}function s(u){u.key==="Escape"&&n()()}ct();var i=Ec();fe("keydown",Mn,s);var o=d(i),v=d(o),l=_(d(v),2);fe("click",l,function(...u){n()?.apply(this,u)}),qe(3,o,()=>Ta,()=>({y:-50,duration:300,easing:Ia})),fe("click",o,Ns(function(u){Os.call(this,a,u)})),fe("click",i,r),qe(3,i,()=>at,()=>({duration:200})),m(e,i),st()}var qc=E('<div class="header-controls svelte-1gty0dt"><button class="btn-icon svelte-1gty0dt" title="AI Settings">‚öôÔ∏è</button> <button class="btn-icon svelte-1gty0dt" title="Help">‚ùì</button> <button class="btn-icon svelte-1gty0dt" title="Exit to Campaign Selection">üö™</button></div> <!> <!>',1);function Sc(e,a){let n=Be(a,"campaign",8,"test-silverpeak"),r=V(!1),s=V(!1);function i(){C(r,!0)}function o(){C(s,!0)}function v(){window.location.href="/dnd"}var l=qc(),u=Se(l),g=d(u),q=_(g,2),y=_(q,2),b=_(u,2);{var p=f=>{xc(f,{get campaign(){return n()},onClose:()=>C(r,!1)})};M(b,f=>{t(r)&&f(p)})}var h=_(b,2);{var S=f=>{kc(f,{onClose:()=>C(s,!1)})};M(h,f=>{t(s)&&f(S)})}fe("click",g,i),fe("click",q,o),fe("click",y,v),m(e,l)}var $c=E('<span class="timestamp svelte-1qsrlxq"> </span>'),Ac=E('<div class="error-banner svelte-1qsrlxq"> </div>'),Cc=E('<div class="info-banner svelte-1qsrlxq">üìò Damage rolls still require manual HP updates in chat‚Äîadjust the tracker once the DM confirms the outcome.</div>'),Tc=E('<li class="svelte-1qsrlxq"> </li>'),Ic=E('<div class="staged-banner svelte-1qsrlxq"><span>üì• Queued results ready to append:</span> <ul class="svelte-1qsrlxq"></ul></div>'),Rc=E('<p class="empty-state svelte-1qsrlxq">No pending roll requests. Enjoy the calm!</p>'),Dc=E('<span class="meta-pill svelte-1qsrlxq"> </span>'),Mc=E('<span class="meta-pill svelte-1qsrlxq"> </span>'),Pc=E('<div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Damage</span> <span> </span></div>'),jc=E('<div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Attacker</span> <span> </span></div> <div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Attack</span> <span> </span></div> <div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Attack Bonus</span> <span> </span></div> <div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Target AC</span> <span> </span></div> <!>',1),Lc=E('<div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">Save</span> <span> </span></div> <div class="combat-row svelte-1qsrlxq"><span class="label svelte-1qsrlxq">DC</span> <span> </span></div>',1),Nc=E("<span> </span>"),Oc=E('<div class="combat-steps svelte-1qsrlxq"></div>'),Fc=E('<div class="combat-action svelte-1qsrlxq"><!> <!></div>'),Uc=E('<div class="participant-actions svelte-1qsrlxq"><button class="action-button primary svelte-1qsrlxq"> </button> <button class="action-button svelte-1qsrlxq"> </button></div>'),Hc=E('<div class="participant-note svelte-1qsrlxq">Awaiting DM-controlled roll.</div>'),Gc=E("<span> </span>"),Bc=E('<span class="result-badge svelte-1qsrlxq">Auto</span>'),Qc=E("<span><!></span>"),Kc=E('<button class="action-button secondary svelte-1qsrlxq">Queue for next prompt</button>'),zc=E('<span class="queued-pill svelte-1qsrlxq">üì• Queued</span>'),Vc=E('<div class="result-action svelte-1qsrlxq"><div class="result-summary svelte-1qsrlxq"><span> </span> <!> <!> <!></div> <!></div>'),Wc=E('<li><div class="participant-info svelte-1qsrlxq"><span class="participant-icon svelte-1qsrlxq"> </span> <div><div class="participant-name svelte-1qsrlxq"> </div> <div class="participant-meta svelte-1qsrlxq"> <!> <!> <!></div></div></div> <!></li>'),Yc=E('<article><header class="svelte-1qsrlxq"><div class="entry-title svelte-1qsrlxq"><span class="entry-icon svelte-1qsrlxq">üåÄ</span> <div><h4 class="svelte-1qsrlxq"> </h4> <div class="meta svelte-1qsrlxq"><!> <!> <span class="meta-pill status svelte-1qsrlxq"> </span></div></div></div> <button class="refresh-button svelte-1qsrlxq" title="Refresh roll queue">‚ü≥</button></header> <!> <ul class="participant-list svelte-1qsrlxq"></ul></article>'),Zc=E('<div class="queue-list svelte-1qsrlxq"></div>'),Jc=E('<li class="svelte-1qsrlxq"><span> </span> <span class="resolved-status svelte-1qsrlxq"> </span></li>'),Xc=E('<details class="resolved-section svelte-1qsrlxq"><summary class="svelte-1qsrlxq"> </summary> <ul class="svelte-1qsrlxq"></ul></details>'),eu=E('<div class="roll-queue-panel svelte-1qsrlxq" role="region" aria-label="Roll Queue"><div class="panel-header svelte-1qsrlxq"><h3 class="svelte-1qsrlxq">üé≤ Pending Rolls</h3> <!></div> <!> <!> <!> <!> <!></div>');function tu(e,a){rt(a,!1);const n=()=>aa(g,"$lastUpdatedStore",l),r=()=>aa(f,"$showDamageReminder",l),s=()=>aa(rn,"$stagedResultsStore",l),i=()=>aa(h,"$pendingEntries",l),o=()=>aa(Za,"$stagedMapStore",l),v=()=>aa(S,"$resolvedEntries",l),[l,u]=Er();Be(a,"campaign",8,"test-silverpeak");const g=nn(null);let q=V({}),y=V(null),b=V(null),p=V(null);const h=fn(jn,D=>D.filter(L=>L.status==="pending"||L.status==="partial")),S=fn(jn,D=>D.filter(L=>L.status==="complete"||L.status==="cancelled")),f=fn([h,S],([D,L])=>[...D,...L].some(w=>{const me=(w?.reason||"").toLowerCase(),le=(w?.metadata?.description||"").toLowerCase(),ie=w?.metadata?.combatAction;return ie?.kind==="attack"&&ie?.awaitingDamage||/damage|hp|wound/.test(me)||/damage|hp|wound/.test(le)}));function T(D){const{rollQueue:L=[],updatedAt:X}=D.detail||{};Hr(L),g.set(X||new Date().toISOString())}function I(D,L){C(q,{...t(q),[D]:L})}function O(D,L){const X=(D?.ability||L?.ability||"").toLowerCase();if(!X)return 0;const me=window.game?.config?.characters||[],le=[],ie=D?.participantId||D?.id,we=D?.name?.toLowerCase();if(ie){const ee=me.find(N=>N.id===ie);ee&&le.push(ee)}if(!le.length&&we){const ee=me.find(N=>N.name?.toLowerCase()===we);ee&&le.push(ee)}if(!le.length&&we){const ee=we.split(/\s+/)[0],N=me.find(de=>de.name?.toLowerCase().startsWith(ee));N&&le.push(N)}const B=le[0]?.abilities?.[X];return Number.isFinite(B)?Math.floor((B-10)/2):0}function P(D){return Number.isFinite(D)?D>=0?`+${D}`:`${D}`:"+0"}function k(D){return D?.metadata?.combatAction||null}function j(D){const L=k(D);if(!L||!Array.isArray(L.steps))return null;const X=Number.isInteger(L.currentStepIndex)?L.currentStepIndex:0;return L.steps[X]||null}function $(D){return D&&D.type==="damage"}function R(D,L){return D?L?.outcome?.crit&&D.critFormula?D.critFormula:D.formula||L?.damage?.formula||null:null}function Q(D){const L=j(D);return $(L)?"Roll Damage":"Auto Roll (d20)"}function K(D){const L=j(D);return $(L)?"Log Damage Result":"Log Manual Result"}function J(D){if(typeof D!="string")return null;const L=D.replace(/\s+/g,""),X=/(\d+)d(\d+)/gi;let w=0;const me=[];let le,ie=!1;for(;(le=X.exec(L))!==null;){ie=!0;const N=Number.parseInt(le[1],10),de=Number.parseInt(le[2],10);if(!(!Number.isFinite(N)||!Number.isFinite(de)||N<=0||de<=0))for(let Ce=0;Ce<N;Ce+=1){const re=Math.floor(Math.random()*de)+1;me.push(re),w+=re}}const we=L.replace(X,""),x=/([+\-]\d+)/g;let B=0,ee;for(;(ee=x.exec(we))!==null;){const N=Number.parseInt(ee[1],10);Number.isFinite(N)&&(B+=N)}return w+=B,!ie&&B!==0&&me.push(B),!ie&&me.length===0?null:{total:w,rolls:me,modifier:B,notation:L}}async function ae(D,L){if(L?.entityType!=="player"){console.warn("Auto roll is only available for player-controlled participants.");return}const X=`${D.queueId}:${L.participantId||L.id||L.name}`;if(!t(q)[X])try{I(X,!0),C(y,null);const w=j(D),me=k(D);if($(w)){const N=R(w,me)||"1d6",de=J(N);if(!de)throw new Error("Unable to parse damage formula.");const Ce={total:de.total,natural:de.total,modifier:de.modifier,notation:de.notation||N,rolls:de.rolls,auto:!0,submittedBy:"auto-roll",advantage:"normal",notes:`Auto damage roll (${N})`,metadata:{ability:L.ability||D.ability||null,formula:N,source:"ui-auto-roll",step:"damage"}};await window.game.submitRollResult(D.queueId,L.participantId||L.id||L.name,Ce);return}const le=O(L,D),ie=L.advantage||D.advantage||"normal",we=[];we.push(Math.floor(Math.random()*20)+1),(ie==="advantage"||ie==="disadvantage")&&we.push(Math.floor(Math.random()*20)+1);let x=we[0];ie==="advantage"?x=Math.max(...we):ie==="disadvantage"&&(x=Math.min(...we));const ee={total:x+le,natural:x,modifier:le,notation:`1d20${P(le)}`,rolls:we,auto:!0,submittedBy:"auto-roll",advantage:ie,notes:`Auto-roll via UI (${ie})`,metadata:{ability:L.ability||D.ability||null,advantage:ie,source:"ui-auto-roll",step:"attack"}};await window.game.submitRollResult(D.queueId,L.participantId||L.id||L.name,ee)}catch(w){console.error("Auto roll failed:",w),C(y,"Auto roll failed. Please try again or enter the result manually.")}finally{I(X,!1)}}async function U(D,L){const X=j(D),w=k(D),me=$(X)?`Enter total damage for ${L.name}`:`Enter total roll result for ${L.name}`,le=window.prompt(me,"");if(le===null)return;const ie=Number(le);if(!Number.isFinite(ie)){window.alert("Please enter a numeric result.");return}const we={total:ie,natural:ie,modifier:0,notation:$(X)&&R(X,w)||"manual",auto:!1,submittedBy:"manual-entry",notes:$(X)?"Manual damage entry via UI":"Manual result entry via UI",metadata:{ability:L.ability||D.ability||null,source:"ui-manual-entry",step:$(X)?"damage":"attack",formula:$(X)&&R(X,w)||null}};try{const x=`${D.queueId}:${L.participantId||L.id||L.name}`;I(x,!0),await window.game.submitRollResult(D.queueId,L.participantId||L.id||L.name,we),C(y,null)}catch(x){console.error("Manual roll submission failed:",x),C(y,"Failed to submit manual result.")}finally{const x=`${D.queueId}:${L.participantId||L.id||L.name}`;I(x,!1)}}function H(D){switch(D.status){case"rolled":return"‚úÖ";case"auto":return"ü§ñ";case"override":return"‚ú≥Ô∏è";case"cancelled":return"‚õî";default:return"‚è≥"}}function G(D,L){return`${D.queueId}:${L.participantId||L.id||L.name}`}function Y(D,L){const X=Bs(D,L);!X.staged&&X.reason?C(y,X.reason):C(y,null)}function W(D){C(b,D),setTimeout(()=>{t(b)===D&&C(b,null)},4e3)}function te(D){const L=D?.metadata?.combatAction;return!L||L.kind!=="attack"?null:L.outcome||null}let Z;gt(()=>{window.addEventListener("rollQueueUpdate",T),Z=D=>{W(D.detail?.queueId)},window.addEventListener("rollQueueFocus",Z),window.game?.rollQueue?(Hr(window.game.rollQueue),g.set(new Date().toISOString())):window.game?.refreshRollQueue?.(!0)}),Fs(()=>{window.removeEventListener("rollQueueUpdate",T),Z&&window.removeEventListener("rollQueueFocus",Z)}),ct();var he=eu(),Le=d(he),Ue=_(d(Le),2);{var xe=D=>{var L=$c(),X=d(L);F(()=>A(X,`Updated ${n()??""}`)),m(D,L)};M(Ue,D=>{n()&&D(xe)})}var Ne=_(Le,2);{var Pe=D=>{var L=Ac(),X=d(L);F(()=>A(X,t(y))),m(D,L)};M(Ne,D=>{t(y)&&D(Pe)})}var ze=_(Ne,2);{var ut=D=>{var L=Cc();m(D,L)};M(ze,D=>{r()&&D(ut)})}var it=_(ze,2);{var oe=D=>{var L=Ic(),X=_(d(L),2);Ge(X,5,s,_t,(w,me)=>{var le=Tc(),ie=d(le);F(()=>A(ie,(t(me),c(()=>t(me).text)))),m(w,le)}),m(D,L)};M(it,D=>{s(),c(()=>s().length)&&D(oe)})}var Tt=_(it,2);{var ht=D=>{var L=Rc();m(D,L)},qt=D=>{var L=Zc();Ge(L,5,i,X=>X.queueId,(X,w)=>{var me=Yc();let le;var ie=d(me),we=d(ie),x=_(d(we),2),B=d(x),ee=d(B),N=_(B,2),de=d(N);{var Ce=ue=>{var z=Dc(),We=d(z);F(wt=>A(We,`Ability: ${wt??""}`),[()=>(t(w),c(()=>t(w).ability.toUpperCase()))]),m(ue,z)};M(de,ue=>{t(w),c(()=>t(w).ability)&&ue(Ce)})}var re=_(de,2);{var _e=ue=>{var z=Mc(),We=d(z);F(()=>A(We,`DC ${t(w),c(()=>t(w).dc)??""}`)),m(ue,z)};M(re,ue=>{t(w),c(()=>t(w).dc)&&ue(_e)})}var be=_(re,2),vt=d(be),dt=_(we,2),It=_(ie,2);{var Rt=ue=>{var z=Fc(),We=d(z);{var wt=$e=>{var se=jc(),ye=Se(se),ke=_(d(ye),2),bt=d(ke),ft=_(ye,2),Mt=_(d(ft),2),Pt=d(Mt),Bt=_(ft,2),la=_(d(Bt),2),ba=d(la),Jt=_(Bt,2),ya=_(d(Jt),2),ca=d(ya),Ie=_(Jt,2);{var Oe=jt=>{var Lt=Pc(),Xt=_(d(Lt),2),yt=d(Xt);F(()=>A(yt,`${t(w),c(()=>t(w).metadata.combatAction.damage.formula)??""}${t(w),c(()=>t(w).metadata.combatAction.damage.type?` (${t(w).metadata.combatAction.damage.type})`:"")??""}`)),m(jt,Lt)};M(Ie,jt=>{t(w),c(()=>t(w).metadata.combatAction.damage?.formula)&&jt(Oe)})}F((jt,Lt)=>{A(bt,(t(w),c(()=>t(w).metadata.combatAction.attacker?.name??"Unknown"))),A(Pt,`${t(w),c(()=>t(w).metadata.combatAction.attackName??"Attack")??""} (${t(w),c(()=>t(w).metadata.combatAction.attackType)??""})`),A(ba,jt),A(ca,Lt)},[()=>(t(w),c(()=>Number.isFinite(t(w).metadata.combatAction.attackBonus)?`+${t(w).metadata.combatAction.attackBonus}`:"‚Äî")),()=>(t(w),c(()=>Number.isFinite(t(w).metadata.combatAction.targetAC)?t(w).metadata.combatAction.targetAC:"Unknown"))]),m($e,se)},Dt=$e=>{var se=Ke(),ye=Se(se);{var ke=bt=>{var ft=Lc(),Mt=Se(ft),Pt=_(d(Mt),2),Bt=d(Pt),la=_(Mt,2),ba=_(d(la),2),Jt=d(ba);F((ya,ca)=>{A(Bt,ya),A(Jt,ca)},[()=>(t(w),c(()=>t(w).metadata.combatAction.ability?.toUpperCase()??"Save")),()=>(t(w),c(()=>Number.isFinite(t(w).metadata.combatAction.dc)?t(w).metadata.combatAction.dc:"Unknown"))]),m(bt,ft)};M(ye,bt=>{t(w),c(()=>t(w).metadata.combatAction.kind==="saving-throw")&&bt(ke)},!0)}m($e,se)};M(We,$e=>{t(w),c(()=>t(w).metadata.combatAction.kind==="attack")?$e(wt):$e(Dt,!1)})}var Gt=_(We,2);{var Qe=$e=>{var se=Oc();Ge(se,5,()=>(t(w),c(()=>t(w).metadata.combatAction.steps)),_t,(ye,ke,bt)=>{var ft=Nc();let Mt;var Pt=d(ft);F(Bt=>{Mt=ge(ft,1,"svelte-1qsrlxq",null,Mt,Bt),A(Pt,(t(ke),c(()=>t(ke).type==="attack"?"Attack":t(ke).type==="damage"?"Damage":t(ke).type)))},[()=>({active:bt===(t(w).metadata.combatAction.currentStepIndex??0),complete:t(ke).status==="complete",skipped:t(ke).status==="skipped"})]),m(ye,ft)}),m($e,se)};M(Gt,$e=>{t(w),c(()=>t(w).metadata.combatAction.steps)&&$e(Qe)})}m(ue,z)};M(It,ue=>{t(w),c(()=>t(w).metadata?.combatAction)&&ue(Rt)})}var Ee=_(It,2);Ge(Ee,5,()=>(t(w),c(()=>t(w).participants)),ue=>ue.participantId,(ue,z)=>{var We=Wc();let wt;var Dt=d(We),Gt=d(Dt),Qe=d(Gt),$e=_(Gt,2),se=d($e),ye=d(se),ke=_(se,2),bt=d(ke),ft=_(bt);{var Mt=Ie=>{var Oe=Fe();F(()=>A(Oe,`¬∑ ${t(z),c(()=>t(z).advantage)??""}`)),m(Ie,Oe)};M(ft,Ie=>{t(z),c(()=>t(z).advantage&&t(z).advantage!=="normal")&&Ie(Mt)})}var Pt=_(ft,2);{var Bt=Ie=>{var Oe=Fe("¬∑ Damage");m(Ie,Oe)};M(Pt,Ie=>{t(w),c(()=>j(t(w))?.type==="damage"&&j(t(w))?.status!=="complete")&&Ie(Bt)})}var la=_(Pt,2);{var ba=Ie=>{var Oe=Fe();F(()=>A(Oe,`¬∑ Total ${t(z),c(()=>t(z).result.total)??""}`)),m(Ie,Oe)};M(la,Ie=>{t(z),c(()=>t(z).result)&&Ie(ba)})}var Jt=_(Dt,2);{var ya=Ie=>{var Oe=Ke(),jt=Se(Oe);{var Lt=yt=>{var ea=Uc(),ne=d(ea),ce=d(ne),Re=_(ne,2),Ye=d(Re);F((Xe,Me,He,ta)=>{ne.disabled=Xe,A(ce,Me),Re.disabled=He,A(Ye,ta)},[()=>(t(q),t(w),t(z),c(()=>t(q)[G(t(w),t(z))])),()=>(t(q),t(w),t(z),c(()=>t(q)[G(t(w),t(z))]?"Rolling‚Ä¶":Q(t(w)))),()=>(t(q),t(w),t(z),c(()=>t(q)[G(t(w),t(z))])),()=>(t(w),c(()=>K(t(w))))]),fe("click",ne,()=>ae(t(w),t(z))),fe("click",Re,()=>U(t(w),t(z))),m(yt,ea)},Xt=yt=>{var ea=Hc();m(yt,ea)};M(jt,yt=>{t(z),c(()=>t(z).entityType==="player")?yt(Lt):yt(Xt,!1)})}m(Ie,Oe)},ca=Ie=>{var Oe=Ke(),jt=Se(Oe);{var Lt=Xt=>{var yt=Vc(),ea=d(yt),ne=d(ea),ce=d(ne),Re=_(ne,2);{var Ye=je=>{var et=Gc(),on=d(et);F(ln=>A(on,`(${ln??""})`),[()=>(t(z),c(()=>P(t(z).result.modifier)))]),m(je,et)};M(Re,je=>{t(z),c(()=>Number.isFinite(t(z).result.modifier)&&t(z).result.modifier!==0)&&je(Ye)})}var Xe=_(Re,2);{var Me=je=>{var et=Bc();m(je,et)};M(Xe,je=>{t(z),c(()=>t(z).result.auto)&&je(Me)})}var He=_(Xe,2);{var ta=je=>{var et=Qc(),on=d(et);{var ln=ua=>{var va=Fe("Crit");m(ua,va)},zn=ua=>{var va=Ke(),qn=Se(va);{var Vn=da=>{var ja=Fe("Fumble");m(da,ja)},Wn=da=>{var ja=Ke(),pt=Se(ja);{var Qt=fa=>{var La=Fe("Hit");m(fa,La)},Yn=fa=>{var La=Ke(),Ks=Se(La);{var zs=Na=>{var Zn=Fe("Miss");m(Na,Zn)},Vs=Na=>{var Zn=Fe("Resolved");m(Na,Zn)};M(Ks,Na=>{t(p),c(()=>t(p).hit===!1)?Na(zs):Na(Vs,!1)},!0)}m(fa,La)};M(pt,fa=>{t(p),c(()=>t(p).hit===!0)?fa(Qt):fa(Yn,!1)},!0)}m(da,ja)};M(qn,da=>{t(p),c(()=>t(p).fumble)?da(Vn):da(Wn,!1)},!0)}m(ua,va)};M(on,ua=>{t(p),c(()=>t(p).crit)?ua(ln):ua(zn,!1)})}F(()=>ge(et,1,(t(p),c(()=>`result-tag ${t(p).crit?"crit":t(p).fumble?"fumble":t(p).hit===!0?"hit":t(p).hit===!1?"miss":""}`)),"svelte-1qsrlxq")),m(je,et)};M(He,je=>{t(p),t(w),c(()=>C(p,te(t(w))))&&je(ta)})}var Pa=_(ea,2);{var xa=je=>{var et=Kc();fe("click",et,()=>Y(t(w),t(z))),m(je,et)},sn=je=>{var et=zc();m(je,et)};M(Pa,je=>{o(),t(w),t(z),c(()=>!o()[G(t(w),t(z))])?je(xa):je(sn,!1)})}F(()=>A(ce,`Total: ${t(z),c(()=>t(z).result.total)??""}`)),m(Xt,yt)};M(jt,Xt=>{t(z),c(()=>t(z).result)&&Xt(Lt)},!0)}m(Ie,Oe)};M(Jt,Ie=>{t(z),c(()=>t(z).status==="pending")?Ie(ya):Ie(ca,!1)})}F((Ie,Oe)=>{wt=ge(We,1,"svelte-1qsrlxq",null,wt,Ie),A(Qe,Oe),A(ye,(t(z),c(()=>t(z).name))),A(bt,`${t(z),c(()=>t(z).entityType==="enemy"?"DM-controlled":"Player")??""} `)},[()=>({completed:t(z).status!=="pending"&&t(z).status!=="partial"}),()=>(t(z),c(()=>H(t(z))))]),m(ue,We)}),F(ue=>{le=ge(me,1,"queue-entry svelte-1qsrlxq",null,le,ue),A(ee,(t(w),c(()=>t(w).reason))),A(vt,(t(w),c(()=>t(w).status)))},[()=>({focused:t(b)===t(w).queueId})]),fe("click",dt,()=>window.game?.refreshRollQueue?.(!0)),m(X,me)}),m(D,L)};M(Tt,D=>{i(),c(()=>i().length===0)?D(ht):D(qt,!1)})}var St=_(Tt,2);{var Ve=D=>{var L=Xc(),X=d(L),w=d(X),me=_(X,2);Ge(me,5,v,le=>le.queueId,(le,ie)=>{var we=Jc(),x=d(we),B=d(x),ee=_(x,2),N=d(ee);F(()=>{A(B,(t(ie),c(()=>t(ie).reason))),A(N,(t(ie),c(()=>t(ie).status)))}),m(le,we)}),F(()=>A(w,`Resolved Entries (${v(),c(()=>v().length)??""})`)),m(D,L)};M(St,D=>{v(),c(()=>v().length>0)&&D(Ve)})}m(e,he),st(),u()}var au=E("<button> </button>"),nu=E('<div class="roll-summary-bar svelte-136ywow"></div>'),ru=E('<span class="round-counter svelte-136ywow"> </span>'),su=E('<span class="inactive-label svelte-136ywow">No Active Combat</span>'),iu=E('<span class="poll-indicator svelte-136ywow" title="Refreshing combat state" aria-label="Refreshing combat state">‚ü≥</span>'),ou=E('<p class="context-line svelte-136ywow"><strong>Encounter:</strong> </p>'),lu=E('<span class="context-pill svelte-136ywow"> </span>'),cu=E('<span class="context-pill svelte-136ywow"> </span>'),uu=E('<div class="encounter-context svelte-136ywow"><!> <div class="context-grid svelte-136ywow"><!> <!> <span class="context-pill svelte-136ywow"> </span> <span class="context-pill svelte-136ywow"> </span></div></div>'),vu=E(' <code class="turn-hint svelte-136ywow">/end turn</code> in chat to pass play.',1),du=E('<span class="pending-turn-ondeck svelte-136ywow"> </span>'),fu=E('<div class="pending-turn-banner svelte-136ywow"><!> <!></div>'),pu=E('<div class="combat-summary svelte-136ywow"><div class="summary-pill svelte-136ywow"> </div> <div class="summary-pill svelte-136ywow"> </div> <div class="summary-pill svelte-136ywow"> </div> <div class="summary-pill svelte-136ywow"> </div></div> <!>',1),mu=E('<span class="turn-arrow svelte-136ywow">‚Üí</span>'),_u=E('<button class="roll-alert pending svelte-136ywow">‚ö†Ô∏è Needs roll</button>'),gu=E('<button class="roll-alert ready svelte-136ywow">üì• Result ready</button>'),hu=E('<span class="roll-alert staged svelte-136ywow">üì¶ Queued</span>'),wu=E("<button>üìã Details</button>"),bu=E('<div class="hp-bar-container svelte-136ywow"><div></div> <span class="hp-text svelte-136ywow"> </span></div>'),yu=E('<div class="economy-note svelte-136ywow">DM-tracked; values update when the DM marks usage in the log.</div>'),xu=E('<div><div><div class="action-item-header svelte-136ywow"><span class="action-icon svelte-136ywow">‚öîÔ∏è</span> <span class="action-label">Action</span></div> <span class="economy-state svelte-136ywow"> </span></div> <div><div class="action-item-header svelte-136ywow"><span class="action-icon svelte-136ywow">‚ö°</span> <span class="action-label">Bonus</span></div> <span class="economy-state svelte-136ywow"> </span></div> <div><div class="action-item-header svelte-136ywow"><span class="action-icon svelte-136ywow">üëü</span> <span class="action-label">Movement</span></div> <span class="economy-state movement svelte-136ywow"><!></span></div> <div><div class="action-item-header svelte-136ywow"><span class="action-icon svelte-136ywow">üõ°Ô∏è</span> <span class="action-label">Reaction</span></div> <span class="economy-state svelte-136ywow"> </span></div> <!></div>'),Eu=E('<span class="condition-badge svelte-136ywow"> </span>'),ku=E('<div class="conditions svelte-136ywow"></div>'),qu=E('<div class="character-details svelte-136ywow"><!></div>'),Su=E('<div role="listitem"><div class="combatant-header svelte-136ywow"><div class="combatant-info svelte-136ywow"><span class="init-number svelte-136ywow"> </span> <span class="combatant-name svelte-136ywow"><!> </span></div> <div class="combatant-stats svelte-136ywow"><span class="turn-indicator svelte-136ywow" aria-live="polite"><!></span> <!> <!> <span class="ac-badge svelte-136ywow"> </span> <span> </span></div></div> <!> <!> <!> <!></div>'),$u=E('<div class="initiative-list svelte-136ywow" role="list" aria-label="Initiative order"></div>'),Au=E('<div class="no-combat svelte-136ywow"><p class="help-text svelte-136ywow">Combat will begin when initiative is rolled.</p> <p class="hint svelte-136ywow">Type "roll initiative" to start!</p></div>'),Cu=E('<div class="error-message svelte-136ywow"><span class="error-icon svelte-136ywow">‚ö†Ô∏è</span> </div>'),Tu=E('<div class="combat-tracker svelte-136ywow" role="region" aria-label="Combat Tracker"><!> <div class="combat-header svelte-136ywow"><h3 class="svelte-136ywow">‚öîÔ∏è Combat Tracker</h3> <!> <!></div> <!> <!> <!> <!> <!></div>');function Iu(e,a){rt(a,!1);const n=()=>aa(Qs,"$participantRollStatus",s),r=()=>aa(sc,"$rollSummaryList",s),[s,i]=Er(),o=V(),v=V(),l=V(),u=V(),g=V(),q=V(),y=V(),b=V(),p=V(),h=V();let S=Be(a,"campaign",8,"test-silverpeak"),f=V(Nn),T=V(!1),I=V(null),O=V(null),P,k=V({}),j=V([]),$=V(null);function R(x){const B=x||Nn,ee=t(f)?.active;C(f,B),t(f).active&&!ee?(console.log("‚öîÔ∏è  Combat mode ACTIVATED via store update"),document.body.classList.add("combat-mode")):!t(f).active&&ee&&(console.log("‚öîÔ∏è  Combat mode DEACTIVATED via store update"),console.trace("Stack trace for deactivation"),document.body.classList.remove("combat-mode"),C(O,null))}function Q(x){x.detail&&Ua.setState(x.detail)}function K(x){x?.detail&&C($,x.detail)}gt(()=>(P=Ua.subscribe(({state:x,loading:B,error:ee})=>{R(x),C(T,B),C(I,ee)}),Ua.setCampaign(S(),{fetch:!1}),window.addEventListener("combatStateUpdate",Q),window.addEventListener("turnPrompt",K),()=>{window.removeEventListener("combatStateUpdate",Q),window.removeEventListener("turnPrompt",K),Ua.stop(),P?.(),document.body.classList.remove("combat-mode")}));function J(x){if(!x?.hp)return null;const B=U(x.hp.current),ee=U(x.hp.max);return B===null||ee===null||ee<=0?null:Math.max(0,Math.min(100,B/ee*100))}function ae(x){return x>75?"hp-healthy":x>50?"hp-wounded":x>25?"hp-bloodied":"hp-critical"}const U=x=>{if(x==null||x==="")return null;const B=Number(x);return Number.isFinite(B)?B:null},H=x=>{if(!x?.hp)return"?? HP";if(x.isPlayer){const B=x.hp.current??"?",ee=x.hp.max??"?";return`${B}/${ee} HP`}return"??/?? HP"},G=x=>{if(!x)return!1;const B=U(x?.hp?.current);return B===null?!0:B>0},Y=x=>{if(!x)return!1;const B=U(x?.hp?.current);return B===null?!1:B<=0};function W(x){return x==null?"Unknown":x<=0?"Down":x<=15?"Critical":x<=40?"Bloodied":x<=70?"Wounded":"Healthy"}function te(x){C(O,t(O)===x?null:x)}function Z(x){if(!x)return null;const B=tc(x.id||x.name);return t(k)[B]}function he(x){const B=x?.pending?.[0];B&&Br(B.queueId)}function Le(x){const B=x?.ready?.find(ee=>!ee.staged);B&&Qr(B)}function Ue(x){x&&(x.type==="pending"?Br(x.queueId):x.type==="ready"&&Qr(x))}function xe(x){if(!t(f)?.active)return"pending";const B=Number.isInteger(t(f).currentTurn)?t(f).currentTurn:0;return x===B?"active":x<B?"complete":"pending"}tt(()=>Ae(S()),()=>{Ua.setCampaign(S(),{fetch:!1})}),tt(()=>n(),()=>{C(k,n())}),tt(()=>r(),()=>{C(j,r())}),tt(()=>t(f),()=>{C(o,Array.isArray(t(f)?.initiativeOrder)?t(f).initiativeOrder:[])}),tt(()=>t(o),()=>{C(v,t(o).filter(x=>x?.isPlayer&&G(x)).length)}),tt(()=>t(o),()=>{C(l,t(o).filter(x=>!x?.isPlayer&&G(x)).length)}),tt(()=>t(o),()=>{C(u,t(o).filter(x=>x?.isPlayer&&Y(x)).length)}),tt(()=>t(o),()=>{C(g,t(o).filter(x=>!x?.isPlayer&&Y(x)).length)}),tt(()=>t(f),()=>{C(q,Array.isArray(t(f)?.participants?.players)?t(f).participants.players:[])}),tt(()=>t(f),()=>{C(y,Array.isArray(t(f)?.participants?.enemies)?t(f).participants.enemies:[])}),tt(()=>(t(q),t(o)),()=>{C(b,t(q).length||t(o).filter(x=>x?.isPlayer).length)}),tt(()=>(t(y),t(o)),()=>{C(p,t(y).length||t(o).filter(x=>!x?.isPlayer).length)}),tt(()=>t(f),()=>{C(h,{reason:t(f)?.context?.reason||null,location:t(f)?.context?.location||null,time:t(f)?.context?.time||null})}),tt(()=>(t($),t(f)),()=>{t($)&&t(f)?.active?Number.isFinite(t($).index)&&t(f).currentTurn===t($).index&&C($,null):t($)&&!t(f)?.active&&C($,null)}),gr(),ct();var Ne=Tu(),Pe=d(Ne);{var ze=x=>{var B=nu();Ge(B,5,()=>t(j),_t,(ee,N)=>{var de=au();let Ce;var re=d(de);F(_e=>{Ce=ge(de,1,"queue-pill svelte-136ywow",null,Ce,_e),A(re,`${t(N),c(()=>t(N).type==="pending"?"‚ö†Ô∏è":t(N).type==="ready"?"üì•":"")??""} ${t(N),c(()=>t(N).label)??""}`)},[()=>({pending:t(N).type==="pending",ready:t(N).type==="ready"})]),fe("click",de,()=>Ue(t(N))),m(ee,de)}),m(x,B)};M(Pe,x=>{t(j),c(()=>t(j).length)&&x(ze)})}var ut=_(Pe,2),it=_(d(ut),2);{var oe=x=>{var B=ru(),ee=d(B);F(()=>{Ba(B,"aria-label",`Current round ${t(f),c(()=>t(f).round)??""}`),A(ee,`Round ${t(f),c(()=>t(f).round)??""}`)}),qe(1,B,()=>at),m(x,B)},Tt=x=>{var B=su();qe(1,B,()=>at),m(x,B)};M(it,x=>{t(f),c(()=>t(f).active)?x(oe):x(Tt,!1)})}var ht=_(it,2);{var qt=x=>{var B=iu();qe(1,B,()=>at),m(x,B)};M(ht,x=>{t(T)&&x(qt)})}var St=_(ut,2);{var Ve=x=>{var B=uu(),ee=d(B);{var N=Ee=>{var ue=ou(),z=_(d(ue));F(()=>A(z,` ${t(h),c(()=>t(h).reason)??""}`)),m(Ee,ue)};M(ee,Ee=>{t(h),c(()=>t(h).reason)&&Ee(N)})}var de=_(ee,2),Ce=d(de);{var re=Ee=>{var ue=lu(),z=d(ue);F(()=>A(z,`üìç ${t(h),c(()=>t(h).location)??""}`)),m(Ee,ue)};M(Ce,Ee=>{t(h),c(()=>t(h).location)&&Ee(re)})}var _e=_(Ce,2);{var be=Ee=>{var ue=cu(),z=d(ue);F(()=>A(z,`üïí ${t(h),c(()=>t(h).time)??""}`)),m(Ee,ue)};M(_e,Ee=>{t(h),c(()=>t(h).time)&&Ee(be)})}var vt=_(_e,2),dt=d(vt),It=_(vt,2),Rt=d(It);F((Ee,ue)=>{A(dt,`üë• Party: ${Ee??""}`),A(Rt,`üõ°Ô∏è Enemies: ${ue??""}`)},[()=>(t(q),c(()=>t(q).length>0?t(q).map(Ee=>Ee.name).join(", "):"Unknown")),()=>(t(y),c(()=>t(y).length>0?t(y).map(Ee=>Ee.name).join(", "):"Unknown"))]),qe(1,B,()=>at),m(x,B)};M(St,x=>{t(f),c(()=>t(f).active)&&x(Ve)})}var D=_(St,2);{var L=x=>{var B=pu(),ee=Se(B),N=d(ee),de=d(N),Ce=_(N,2),re=d(Ce),_e=_(Ce,2),be=d(_e),vt=_(_e,2),dt=d(vt),It=_(ee,2);{var Rt=Ee=>{var ue=fu(),z=d(ue);{var We=Qe=>{var $e=vu(),se=Se($e);F(()=>A(se,`${t($),c(()=>t($).name)??""} is ready when you are. Type `)),m(Qe,$e)},wt=Qe=>{var $e=Fe();F(()=>A($e,`Awaiting ${t($),c(()=>t($).name)??""}'s action...`)),m(Qe,$e)};M(z,Qe=>{t($),c(()=>t($).isPlayer)?Qe(We):Qe(wt,!1)})}var Dt=_(z,2);{var Gt=Qe=>{var $e=du(),se=d($e);F(()=>A(se,`On deck: ${t($),c(()=>t($).onDeck)??""}`)),m(Qe,$e)};M(Dt,Qe=>{t($),c(()=>t($).onDeck)&&Qe(Gt)})}qe(1,ue,()=>at),m(Ee,ue)};M(It,Ee=>{t($),c(()=>t($)?.name)&&Ee(Rt)})}F(()=>{A(de,`üë• Party Alive: ${t(v)??""}/${(t(b)||"‚Äî")??""}`),A(re,`üõ°Ô∏è Enemies Alive: ${t(l)??""}/${(t(p)||"‚Äî")??""}`),A(be,`‚öîÔ∏è Total Combatants: ${t(o),c(()=>t(o).length)??""}`),A(dt,`üíÄ Down: ${t(u)+t(g)}`)}),qe(1,ee,()=>at),m(x,B)};M(D,x=>{t(f),c(()=>t(f).active)&&x(L)})}var X=_(D,2);{var w=x=>{var B=$u();Ge(B,7,()=>(t(f),c(()=>t(f).initiativeOrder)),ee=>ee.name,(ee,N,de)=>{const Ce=Ft(()=>(t(N),c(()=>J(t(N))))),re=Ft(()=>(Ae(t(Ce)),c(()=>W(t(Ce))))),_e=Ft(()=>(Ae(t(de)),c(()=>xe(t(de))))),be=Ft(()=>(t(N),c(()=>t(N).actionEconomy||{action:!0,bonusAction:!0,movement:30,reaction:!0}))),vt=Ft(()=>(Ae(t(be)),c(()=>Number.isFinite(Number(t(be).movement))?Number(t(be).movement):0)));var dt=Su();let It;var Rt=d(dt),Ee=d(Rt),ue=d(Ee),z=d(ue),We=_(ue,2),wt=d(We);{var Dt=ne=>{var ce=mu();m(ne,ce)};M(wt,ne=>{Ae(t(de)),t(f),c(()=>t(de)===t(f).currentTurn)&&ne(Dt)})}var Gt=_(wt),Qe=_(Ee,2),$e=d(Qe),se=d($e);{var ye=ne=>{var ce=Fe("‚ñ∂Ô∏è Acting Now");m(ne,ce)},ke=ne=>{var ce=Ke(),Re=Se(ce);{var Ye=Me=>{var He=Fe("‚úÖ Turn Complete");m(Me,He)},Xe=Me=>{var He=Fe("‚è≥ Waiting");m(Me,He)};M(Re,Me=>{t(_e)==="complete"?Me(Ye):Me(Xe,!1)},!0)}m(ne,ce)};M(se,ne=>{t(_e)==="active"?ne(ye):ne(ke,!1)})}var bt=_($e,2);{var ft=ne=>{var ce=_u();fe("click",ce,()=>he(Z(t(N)))),m(ne,ce)},Mt=ne=>{var ce=Ke(),Re=Se(ce);{var Ye=Me=>{var He=gu();fe("click",He,()=>Le(Z(t(N)))),m(Me,He)},Xe=Me=>{var He=Ke(),ta=Se(He);{var Pa=xa=>{var sn=hu();m(xa,sn)};M(ta,xa=>{t(N),c(()=>Z(t(N))?.stagedCount)&&xa(Pa)},!0)}m(Me,He)};M(Re,Me=>{t(N),c(()=>Z(t(N))?.ready?.some(He=>!He.staged))?Me(Ye):Me(Xe,!1)},!0)}m(ne,ce)};M(bt,ne=>{t(N),c(()=>Z(t(N))?.pending?.length)?ne(ft):ne(Mt,!1)})}var Pt=_(bt,2);{var Bt=ne=>{var ce=wu();let Re;F(Ye=>{Re=ge(ce,1,"btn-details svelte-136ywow",null,Re,Ye),Ba(ce,"aria-label",`Toggle character details for ${t(N),c(()=>t(N).name)??""}`),Ba(ce,"aria-expanded",(t(O),t(N),c(()=>t(O)===t(N).name)))},[()=>({active:t(O)===t(N).name})]),fe("click",ce,()=>te(t(N).name)),m(ne,ce)};M(Pt,ne=>{t(N),c(()=>t(N).isPlayer)&&ne(Bt)})}var la=_(Pt,2),ba=d(la),Jt=_(la,2),ya=d(Jt),ca=_(Rt,2);{var Ie=ne=>{var ce=bu(),Re=d(ce),Ye=_(Re,2),Xe=d(Ye);F((Me,He)=>{ge(Re,1,`hp-bar ${Me??""}`,"svelte-136ywow"),Ps(Re,`width: ${t(Ce)??0??""}%`),A(Xe,`${He??""} ¬∑ ${t(re)??""}`)},[()=>(Ae(t(Ce)),c(()=>ae(t(Ce)))),()=>(t(N),c(()=>H(t(N))))]),m(ne,ce)};M(ca,ne=>{t(N),c(()=>t(N).hp)&&ne(Ie)})}var Oe=_(ca,2);{var jt=ne=>{var ce=xu();let Re;var Ye=d(ce);let Xe;var Me=_(d(Ye),2),He=d(Me),ta=_(Ye,2);let Pa;var xa=_(d(ta),2),sn=d(xa),je=_(ta,2);let et;var on=_(d(je),2),ln=d(on);{var zn=pt=>{var Qt=Fe();F(()=>A(Qt,`${t(vt)??""} ft remaining`)),m(pt,Qt)},ua=pt=>{var Qt=Fe("Spent");m(pt,Qt)};M(ln,pt=>{t(vt)>0?pt(zn):pt(ua,!1)})}var va=_(je,2);let qn;var Vn=_(d(va),2),Wn=d(Vn),da=_(va,2);{var ja=pt=>{var Qt=yu();m(pt,Qt)};M(da,pt=>{t(N),c(()=>t(N).isPlayer)&&pt(ja)})}F((pt,Qt,Yn,fa,La)=>{Re=ge(ce,1,"action-economy svelte-136ywow",null,Re,pt),Xe=ge(Ye,1,"action-item svelte-136ywow",null,Xe,Qt),A(He,(Ae(t(be)),c(()=>t(be).action?"Available":"Spent"))),Pa=ge(ta,1,"action-item svelte-136ywow",null,Pa,Yn),A(sn,(Ae(t(be)),c(()=>t(be).bonusAction?"Available":"Spent"))),et=ge(je,1,"action-item svelte-136ywow",null,et,fa),qn=ge(va,1,"action-item svelte-136ywow",null,qn,La),A(Wn,(Ae(t(be)),c(()=>t(be).reaction?"Available":"Spent")))},[()=>({"player-economy":t(N).isPlayer}),()=>({used:!t(be).action}),()=>({used:!t(be).bonusAction}),()=>({used:t(vt)<=0}),()=>({used:!t(be).reaction})]),qe(3,ce,()=>at,()=>({duration:200})),m(ne,ce)};M(Oe,ne=>{t(N),Ae(t(de)),t(f),c(()=>t(N).isPlayer||t(de)===t(f).currentTurn)&&ne(jt)})}var Lt=_(Oe,2);{var Xt=ne=>{var ce=ku();Ge(ce,5,()=>(t(N),c(()=>t(N).conditions)),_t,(Re,Ye)=>{var Xe=Eu(),Me=d(Xe);F(()=>A(Me,t(Ye))),m(Re,Xe)}),m(ne,ce)};M(Lt,ne=>{t(N),c(()=>t(N).conditions&&t(N).conditions.length>0)&&ne(Xt)})}var yt=_(Lt,2);{var ea=ne=>{var ce=qu(),Re=d(ce);Us(Re,{get campaign(){return S()},get character(){return t(N),c(()=>t(N).name)}}),qe(3,ce,()=>at,()=>({duration:200})),m(ne,ce)};M(yt,ne=>{t(N),t(O),c(()=>t(N).isPlayer&&t(O)===t(N).name)&&ne(ea)})}F((ne,ce)=>{It=ge(dt,1,"combatant-card svelte-136ywow",null,It,ne),Ba(dt,"aria-label",`${t(N),c(()=>t(N).name)??""}, initiative ${t(N),c(()=>t(N).initiative)??""}, ${t(N),c(()=>t(N).isPlayer?"party member":"enemy")??""}, ${t(re)??""}`),A(z,(t(N),c(()=>t(N).initiative))),A(Gt,` ${t(N),c(()=>t(N).name)??""}`),A(ba,`AC ${t(N),c(()=>t(N).isPlayer?t(N).ac??"?":"??")??""}`),ge(Jt,1,`hp-status status-${ce??""}`,"svelte-136ywow"),A(ya,t(re))},[()=>({"current-turn":t(de)===t(f).currentTurn,"turn-active":t(_e)==="active","turn-complete":t(_e)==="complete",player:t(N).isPlayer,enemy:!t(N).isPlayer,downed:Y(t(N))}),()=>(Ae(t(re)),c(()=>t(re).toLowerCase()))]),qe(1,dt,()=>Ta,()=>({y:20,delay:t(de)*50,duration:300,easing:Ia})),m(ee,dt)}),qe(1,B,()=>Ta,()=>({y:20,duration:300,easing:Ia})),m(x,B)},me=x=>{var B=Au();qe(1,B,()=>at),m(x,B)};M(X,x=>{t(f),c(()=>t(f).active&&t(f).initiativeOrder.length>0)?x(w):x(me,!1)})}var le=_(X,2);{var ie=x=>{var B=Cu(),ee=_(d(B));F(()=>A(ee,` ${t(I)??""}`)),qe(3,B,()=>at),m(x,B)};M(le,x=>{t(I)&&x(ie)})}var we=_(le,2);tu(we,{get campaign(){return S()}}),m(e,Ne),st(),i()}function zr(){const e="test-silverpeak",a=document.getElementById("svelte-character-panel");a?(console.log("Mounting Character Manager to #svelte-character-panel"),a.innerHTML="",ma(Bo,{target:a,props:{campaign:e}})):console.error("Mount point #svelte-character-panel not found");const n=document.getElementById("equipment-app");n?(console.log("Mounting Equipment Manager to #equipment-app"),n.innerHTML="",ma(Us,{target:n,props:{campaign:e}})):console.error("Mount point #equipment-app not found");const r=document.getElementById("recent-rolls-app");r?(console.log("Mounting Recent Rolls to #recent-rolls-app"),r.innerHTML="",ma($l,{target:r,props:{campaign:e}})):console.error("Mount point #recent-rolls-app not found");const s=document.getElementById("campaign-notes-app");s?(console.log("Mounting Campaign Notes to #campaign-notes-app"),s.innerHTML="",ma(Cl,{target:s,props:{campaign:e}})):console.error("Mount point #campaign-notes-app not found");const i=document.getElementById("game-area-app");i?(console.log("Mounting Game Area to #game-area-app"),i.innerHTML="",ma(uc,{target:i,props:{campaign:e}})):console.error("Mount point #game-area-app not found");const o=document.getElementById("scene-generator-app");o?(console.log("Mounting Scene Generator to #scene-generator-app"),o.innerHTML="",ma(gc,{target:o,props:{campaign:e}})):console.error("Mount point #scene-generator-app not found");const v=document.getElementById("header-controls-app");v?(console.log("Mounting Header Controls to #header-controls-app"),v.innerHTML="",ma(Sc,{target:v,props:{campaign:e}})):console.error("Mount point #header-controls-app not found");const l=document.getElementById("combat-tracker-app");l?(console.log("Mounting Combat Tracker to #combat-tracker-app"),l.innerHTML="",ma(Iu,{target:l,props:{campaign:e}})):console.error("Mount point #combat-tracker-app not found"),window.addEventListener("combatModeChange",u=>{const{active:g}=u.detail;console.log(`‚öîÔ∏è  Combat mode ${g?"ACTIVATED":"DEACTIVATED"}`),g?document.body.classList.add("combat-mode"):document.body.classList.remove("combat-mode")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",zr):zr();
